<!DOCTYPE html><html lang="ko" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="CircuitBreaker 개요 및 Resilence4J 를 활용한 실습" /><meta name="author" content="jeonyoungho" /><meta property="og:locale" content="ko" /><meta name="description" content="써킷 브레이커 패턴 써킷 브레이커는 누전 차단기라는 뜻을 가진다. 누전차단기는 전기 회로에서 과부하가 걸리거나 단락으로 인한 피해를 막기 위해 자동으로 회로를 정지시키는 장치이다." /><meta property="og:description" content="써킷 브레이커 패턴 써킷 브레이커는 누전 차단기라는 뜻을 가진다. 누전차단기는 전기 회로에서 과부하가 걸리거나 단락으로 인한 피해를 막기 위해 자동으로 회로를 정지시키는 장치이다." /><link rel="canonical" href="https://jeonyoungho.github.io/posts/CircuitBreaker-%EA%B0%9C%EC%9A%94-%EB%B0%8F-Resilence4J-%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%9C-%EC%8B%A4%EC%8A%B5/" /><meta property="og:url" content="https://jeonyoungho.github.io/posts/CircuitBreaker-%EA%B0%9C%EC%9A%94-%EB%B0%8F-Resilence4J-%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%9C-%EC%8B%A4%EC%8A%B5/" /><meta property="og:site_name" content="Youngho’s Devlog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-01-20T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="CircuitBreaker 개요 및 Resilence4J 를 활용한 실습" /><meta name="twitter:site" content="@jeonyoungho_o" /><meta name="twitter:creator" content="@jeonyoungho" /><meta name="google-site-verification" content="eonGeSiIVfF48EnFoJqakC7h2hUzgqxFNJaxkfPiGr0" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"jeonyoungho"},"dateModified":"2023-01-20T00:00:00+09:00","datePublished":"2023-01-20T00:00:00+09:00","description":"써킷 브레이커 패턴 써킷 브레이커는 누전 차단기라는 뜻을 가진다. 누전차단기는 전기 회로에서 과부하가 걸리거나 단락으로 인한 피해를 막기 위해 자동으로 회로를 정지시키는 장치이다.","headline":"CircuitBreaker 개요 및 Resilence4J 를 활용한 실습","mainEntityOfPage":{"@type":"WebPage","@id":"https://jeonyoungho.github.io/posts/CircuitBreaker-%EA%B0%9C%EC%9A%94-%EB%B0%8F-Resilence4J-%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%9C-%EC%8B%A4%EC%8A%B5/"},"url":"https://jeonyoungho.github.io/posts/CircuitBreaker-%EA%B0%9C%EC%9A%94-%EB%B0%8F-Resilence4J-%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%9C-%EC%8B%A4%EC%8A%B5/"}</script><title>CircuitBreaker 개요 및 Resilence4J 를 활용한 실습 | Youngho's Devlog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Youngho's Devlog"><meta name="application-name" content="Youngho's Devlog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-RF6ZGDWXV1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-RF6ZGDWXV1'); }); </script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5958719204143086" crossorigin="anonymous"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/youngho_employee_pic.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Youngho's Devlog</a></div><div class="site-subtitle font-italic">curios developer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/jeonyoungho" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/jeonyoungho_o" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['yhjun1000','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>CircuitBreaker 개요 및 Resilence4J 를 활용한 실습</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"> <ins class="adsbygoogle" style="display:block; margin-top: 30px;" data-ad-client="ca-pub-5958719204143086" data-ad-slot="1982371670" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>CircuitBreaker 개요 및 Resilence4J 를 활용한 실습</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> jeonyoungho </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Jan 20, 2023, 12:00 AM +0900" prep="on" > Jan 20, 2023 <i class="unloaded">2023-01-20T00:00:00+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1553 words">8 min</span></div></div><div class="post-content"><h3 id="써킷-브레이커-패턴">써킷 브레이커 패턴</h3><p>써킷 브레이커는 누전 차단기라는 뜻을 가진다. 누전차단기는 <b>전기 회로에서 과부하가 걸리거나 단락으로 인한 피해를 막기 위해 자동으로 회로를 정지시키는 장치이다.</b></p><p>MSA 로 구성된 환경에서 여러 마이크로서비스들이 존재하고 내부 internal-api 로 통신을 하게 되어 서비스가 운영된다.</p><p>예를 들어, 아래 그림과 같이 <code class="language-plaintext highlighter-rouge">Display</code> 마이크로서비스가 <code class="language-plaintext highlighter-rouge">Product</code>, <code class="language-plaintext highlighter-rouge">Delivery</code>, <code class="language-plaintext highlighter-rouge">Order</code> 마이크로서비스와 내부적인 통신을 가진다고 들어보자.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/213624607-704035b9-aa0a-4842-a13a-d775be9cada2.png" alt="image" /></p><p>만약, <code class="language-plaintext highlighter-rouge">Product</code> 서비스에 장애가 났다고 가정해보자.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/213624806-21f1e57d-dc28-4f90-97b4-1ae2adbb433b.png" alt="image" /></p><p>그럴 경우 이를 호출하는데 <code class="language-plaintext highlighter-rouge">Display</code> 마이크로서비스에도 장애가 이어져 계속 발생하게 될 것이다.</p><p>그래서 이러한 서비스들 간의 장애 전파를 방지하기 위해 적용하는 패턴이 써킷 브레이커 패턴이다.</p><p>추가적인 설명을 해보자면 외부 API 통신의 장애 전파를 막기 위해 특정 시간 동안 특정 비율의 외부 api 통신에 예외가 발생하거나 timeout이 발생하게 되면 이를 통계내어 이를 바탕으로 외부와의 통신을 차단하는 역할하게 된다.</p><h3 id="써킷-브레이커의-내부-상태">써킷 브레이커의 내부 상태</h3><p><a href="https://velog.io/@hgs-study/CircuitBreaker">여기</a> 포스팅에서 너무 잘 설명이 되어 있어서 그대로 인용하였다.</p><p>1) 외부 API 통신 시도</p><p>2) 외부 통신이 몇 번 실패하여 설정된 써킷 오픈 임계치를 넘을 경우, 써킷을 Open</p><ul><li>위에서 언급된 외부 통신 실패는 timeout 또는 외부 api 측 예외 발생 케이스 두 가지 모두 포함될 수 있음</ul><p>3) Open과 동시에 외부 서버에 요청을 날리지 않고, Fail Fast로 빠른응답 리턴</p><p>4) 써킷브레이커가 오픈하면 일정 시간 후에 반오픈(Half-Open) 상태</p><p>5) 반오픈 상태에서 다시 외부 서비스를 호출해서 장애를 확인하면 Open, 정상 응답이면 닫힘</p><ul><li>위에서 “장애 확인”이라고 표현한 것은, 총(n)번 통신 중 실패율(n%)를 지정할 수 있다.<ul><li>ex) 10번 중 50% =&gt; 10번 중 6번이 에러 발생하면 서킷브레이커 Open</ul></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/213625568-38d38451-9d31-41fe-b9a9-64055a2a70a7.png" alt="image" /></p><h3 id="circuitbreaker-구현체">CircuitBreaker 구현체</h3><p>CircuitBreaker 를 제공하는 라이브러리 중에 <code class="language-plaintext highlighter-rouge">Netflix Hystrix</code>와 <code class="language-plaintext highlighter-rouge">Resilience4j</code> 두 가지가 존재한다.</p><p><code class="language-plaintext highlighter-rouge">Hystrix</code>는 Java 6을 기반으로 만들어졌지만 <code class="language-plaintext highlighter-rouge">Resilience4j</code>는 Java 8 기반이며 <code class="language-plaintext highlighter-rouge">Hystrix</code> 와는 다르게 다른 라이브러의 의존성이 없어서 가볍다.</p><p>Netflix Hystrix는 공식적으로 2018년 앞으로 개발을 중단하고 유지보수 상태라는 글이 명시되어 있어 <code class="language-plaintext highlighter-rouge">Resilience4j</code> 를 많이 사용하는 추세다.</p><blockquote><p><strong>Note</strong>: <code class="language-plaintext highlighter-rouge">Resilience4j</code> 는 5개의 모듈(<code class="language-plaintext highlighter-rouge">CircuitBreaker</code>, <code class="language-plaintext highlighter-rouge">Bulkhead</code>, <code class="language-plaintext highlighter-rouge">RateLimiter</code>, <code class="language-plaintext highlighter-rouge">Retry</code>, <code class="language-plaintext highlighter-rouge">TimeLimiter</code>)로 구성되어 있어서 학습해보면 좋다.</p></blockquote><p>간략하게 설명하면 아래와 같다.</p><ul><li><code class="language-plaintext highlighter-rouge">CircuitBreaker</code>: 장애 전파를 방지하기 위해 사용<li><code class="language-plaintext highlighter-rouge">Bulkhead</code>: 동시 실행(Concurrent execution) 수를 제한하는데 사용<li><code class="language-plaintext highlighter-rouge">RateLimiter</code>: 일정 시간동안 요청 수를 제한하는데 사용<li><code class="language-plaintext highlighter-rouge">Retry</code>: 요청이 실패했을 경우 재시도 정책에 관련한 조건을 관리하기 위해 사용<li><code class="language-plaintext highlighter-rouge">TimeLimiter</code>: 원격 서버를 호출하는데 걸리는 시간을 제한</ul><h3 id="feign과-resilience4j를-활용한-써킷브레이커-적용-예시">Feign과 Resilience4j를 활용한 써킷브레이커 적용 예시</h3><p>예시 프로젝트는 <a href="https://github.com/jeonyoungho/spring-cloud-resilience4j">깃허브 레포지토리</a>를 참고하면 좋다.</p><p>아래는 주요 클래스이다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="c1">// Resilience4J 설정 클래스</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Resilience4JConfig</span> <span class="o">{</span>

	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="nc">Customizer</span><span class="o">&lt;</span><span class="nc">Resilience4JCircuitBreakerFactory</span><span class="o">&gt;</span> <span class="nf">globalCustomConfig</span><span class="o">()</span> <span class="o">{</span>
		<span class="nc">CircuitBreakerConfig</span> <span class="n">circuitBreakerConfig</span> <span class="o">=</span>
				<span class="nc">CircuitBreakerConfig</span><span class="o">.</span><span class="na">custom</span><span class="o">()</span>
									<span class="o">.</span><span class="na">ringBufferSizeInClosedState</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="c1">// 닫힌 상태에서의 호출 수로, 써킷을 열어야 할지 결정할 때 사용</span>
									<span class="o">.</span><span class="na">ringBufferSizeInHalfOpenState</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="c1">// 열림 상태를 유지하는 시간(단위: 초), 해당 시간이후 반열림 상태로 변경</span>
									<span class="o">.</span><span class="na">failureRateThreshold</span><span class="o">(</span><span class="mi">50</span><span class="o">)</span> <span class="c1">// 실패한 호출에 대한 임계값(백분율), 이 값을 초과하면 써킷 오픈</span>
									<span class="o">.</span><span class="na">waitDurationInOpenState</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofMillis</span><span class="o">(</span><span class="mi">10000</span><span class="o">))</span> <span class="c1">// 써킷 오픈 지속 시간</span>
									<span class="o">.</span><span class="na">slidingWindowType</span><span class="o">(</span><span class="nc">CircuitBreakerConfig</span><span class="o">.</span><span class="na">SlidingWindowType</span><span class="o">.</span><span class="na">COUNT_BASED</span><span class="o">)</span> <span class="c1">// 통계 집계 방식, 마지막 N번의 호출 결과를 집계, COUNT_BASED / TIME_BASED</span>
									<span class="o">.</span><span class="na">build</span><span class="o">();</span>

		<span class="nc">TimeLimiterConfig</span> <span class="n">timeLimiterConfig</span> <span class="o">=</span> <span class="nc">TimeLimiterConfig</span><span class="o">.</span><span class="na">custom</span><span class="o">()</span>
															   <span class="o">.</span><span class="na">timeoutDuration</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span> <span class="c1">// 타임 아웃 기간</span>
															   <span class="o">.</span><span class="na">build</span><span class="o">();</span>

		<span class="k">return</span> <span class="n">factory</span> <span class="o">-&gt;</span> <span class="n">factory</span><span class="o">.</span><span class="na">configureDefault</span><span class="o">(</span><span class="n">id</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">Resilience4JConfigBuilder</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
				<span class="o">.</span><span class="na">timeLimiterConfig</span><span class="o">(</span><span class="n">timeLimiterConfig</span><span class="o">)</span>
				<span class="o">.</span><span class="na">circuitBreakerConfig</span><span class="o">(</span><span class="n">circuitBreakerConfig</span><span class="o">)</span>
				<span class="o">.</span><span class="na">build</span><span class="o">()</span>
		<span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1">// 서비스</span>
<span class="nd">@Slf4j</span>
<span class="nd">@Service</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductDisplayService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ProductRemoteFeignService</span> <span class="n">productRemoteFeignService</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">displayProducts</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">products</span> <span class="o">=</span> <span class="n">productRemoteFeignService</span><span class="o">.</span><span class="na">products</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">products</span><span class="o">.</span><span class="na">isPresent</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"product api result is empty!!"</span><span class="o">);</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"products is empty!"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">products</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="c1">// product 외부 통신용 feign 정의 및 fallback factory 설정</span>
<span class="nd">@FeignClient</span><span class="o">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">"product"</span><span class="o">,</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">"localhost:8066"</span><span class="o">,</span>
        <span class="n">fallbackFactory</span> <span class="o">=</span> <span class="nc">ProductRemoteFallbackFactory</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductRemoteFeignService</span> <span class="o">{</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/external-api/products"</span><span class="o">)</span>
    <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">products</span><span class="o">();</span>
<span class="o">}</span>


<span class="nd">@Slf4j</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductRemoteFallbackFactory</span> <span class="kd">implements</span> <span class="nc">FallbackFactory</span><span class="o">&lt;</span><span class="nc">ProductRemoteFeignService</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">ProductRemoteFeignService</span> <span class="nf">create</span><span class="o">(</span><span class="nc">Throwable</span> <span class="n">cause</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ProductRemoteFeignService</span><span class="o">()</span> <span class="o">{</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">products</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"[ProductRemoteFallbackFactory] products API call error. "</span> <span class="o">+</span>
                        <span class="s">"cause = {}"</span><span class="o">,</span> <span class="n">cause</span><span class="o">);</span>
                <span class="k">return</span> <span class="nc">Optional</span><span class="o">.</span><span class="na">empty</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">};</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c1">// product 마이크로서비스 외부 통신용 api</span>

<span class="nd">@RestController</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/external-api"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExternalProductController</span> <span class="o">{</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/products"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">products</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"runtime exception!!!"</span><span class="o">);</span> <span class="c1">// 강제 exception 발생</span>
<span class="c1">//        return "products exist!";</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>위 <code class="language-plaintext highlighter-rouge">Resilience4J</code> 설정에 따라 다음과 아래와 결과가 발생한다..</p><p><b>1) display 서비스 -&gt; product 서비스 5번(ringBufferSizeInClosedState)까지 호출 및 exception 발생</b></p><ul><li>6번째부터 product 서비스로의 호출 차단(fallback 메서드 적용)<li>slidingWindowType(통계 집계 방식)을 COUNT_BASED로 지정, 마지막 N번의 호출 결과를 집계</ul><p><b>2) DurationInOpenState 값(써킷 오픈 지속 시간) 으로 지정된 10초가 지나면 써킷 반오픈 상태로 변경</b></p><ul><li>반열림 상태에서 RingBufferSizeInHalfOpenState(반열림 상태에서의 호출 수)로 지정된 1만큼 product 서비스로 재호출<ul><li>만약, 성공하면 CLOSE 상태로 변경 및 실패시 다시 OPEN 상태로 변경</ul></ul><h4 id="출처">출처</h4><ul><li><a href="https://github.com/jeonyoungho/MSA-basics-using-Spring-cloud/blob/main/4%EA%B0%95-Circuit%20Breaker-Hystrix.md">https://github.com/jeonyoungho/MSA-basics-using-Spring-cloud/blob/main/4%EA%B0%95-Circuit%20Breaker-Hystrix.md</a><li><a href="https://velog.io/@hgs-study/CircuitBreaker">https://velog.io/@hgs-study/CircuitBreaker</a><li><a href="https://sabarada.tistory.com/118">https://sabarada.tistory.com/118</a><li><p><a href="https://brunch.co.kr/@springboot/262">https://brunch.co.kr/@springboot/262</a></p><li><a href="https://jydlove.tistory.com/71">https://jydlove.tistory.com/71</a><li><a href="https://bottom-to-top.tistory.com/57">https://bottom-to-top.tistory.com/57</a><li><a href="https://cheese10yun.github.io/resilience4j-basic/">https://cheese10yun.github.io/resilience4j-basic/</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/backend/'>Backend</a>, <a href='/categories/msa/'>MSA</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/msa/" class="post-tag no-text-decoration" >msa</a> <a href="/tags/microservicearchitecture/" class="post-tag no-text-decoration" >microservicearchitecture</a> <a href="/tags/circuitbreaker/" class="post-tag no-text-decoration" >circuitbreaker</a> <a href="/tags/hystrix/" class="post-tag no-text-decoration" >hystrix</a> <a href="/tags/resilience4j/" class="post-tag no-text-decoration" >resilience4j</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=CircuitBreaker 개요 및 Resilence4J 를 활용한 실습 - Youngho's Devlog&url=https://jeonyoungho.github.io/posts/CircuitBreaker-%EA%B0%9C%EC%9A%94-%EB%B0%8F-Resilence4J-%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%9C-%EC%8B%A4%EC%8A%B5/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=CircuitBreaker 개요 및 Resilence4J 를 활용한 실습 - Youngho's Devlog&u=https://jeonyoungho.github.io/posts/CircuitBreaker-%EA%B0%9C%EC%9A%94-%EB%B0%8F-Resilence4J-%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%9C-%EC%8B%A4%EC%8A%B5/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=CircuitBreaker 개요 및 Resilence4J 를 활용한 실습 - Youngho's Devlog&url=https://jeonyoungho.github.io/posts/CircuitBreaker-%EA%B0%9C%EC%9A%94-%EB%B0%8F-Resilence4J-%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%9C-%EC%8B%A4%EC%8A%B5/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5958719204143086" data-ad-slot="1982371670" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-5958719204143086" data-ad-slot="5918543412"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <script src="https://utteranc.es/client.js" repo="jeonyoungho/jeonyoungho.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Kafka-%EB%A9%94%EC%8B%9C%EC%A7%80-%EC%A0%84%EB%8B%AC-%EB%B3%B4%EC%9E%A5-%EB%B0%A9%EC%8B%9D/">Kafka 메시지 전달 보장 방식</a><li><a href="/posts/Transactional-Outbox-%ED%8C%A8%ED%84%B4/">Transactional Outbox 패턴</a><li><a href="/posts/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EC%9D%B8%EB%8D%B1%EC%8A%A4-%EC%A1%B0%EA%B0%81%ED%99%94/">데이터베이스 인덱스 조각화(Fragmentation)</a><li><a href="/posts/Kafka-DeadLetter-%EA%B4%80%EB%A6%AC/">Kafka DeadLetter 관리</a><li><a href="/posts/Redis-%ED%8A%B9%EC%A7%95/">Redis 특징</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/effectivejava/">effectivejava</a> <a class="post-tag" href="/tags/react/">react</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/es6/">es6</a> <a class="post-tag" href="/tags/velopert/">velopert</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/poiemaweb/">poiemaweb</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Spring-Cloud-%EA%B0%9C%EC%9A%94/"><div class="card-body"> <span class="timeago small" > Jul 1, 2021 <i class="unloaded">2021-07-01T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[MSA] Spring Cloud 개요</h3><div class="text-muted small"><p> Spring Cloud란? 마이크로서비스의 개발, 배포, 운영에 필요한 아키텍처를 쉽게 구성할 수 있도록 지원하는 Spring Boot기반의 프레임워크 즉, MSA구성을 지원하는 Springboot기반의 프레임워크이다. Spring Cloud의 핵심 Component Spring cloud 컴포넌트 메뉴얼 Spring cloud는...</p></div></div></a></div><div class="card"> <a href="/posts/MSA-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C%EC%9D%98-%EB%B6%84%EC%82%B0-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EA%B4%80%EB%A6%AC/"><div class="card-body"> <span class="timeago small" > Apr 10 <i class="unloaded">2025-04-10T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>MSA 환경에서의 분산 트랜잭션 관리</h3><div class="text-muted small"><p> MSA 환경에서 고민해야되는 포인트는 도메인별로 분산된 DB를 가질때의 트랜잭션 관리다. 단일 DB에서 제공하는 트랜잭션을 활용할 수 없다보니 전체적인 데이터 일관성과 무결성을 보장하기 위한 고민이 필요하다. 이를 해결하기 위한 대표적인 방식인 2PC 프로토콜(2Phase Commit)과 Saga Pattern에 대해 알아보자. 2PC(2Phas...</p></div></div></a></div><div class="card"> <a href="/posts/Kafka-Connect-%EB%9E%80/"><div class="card-body"> <span class="timeago small" > Mar 10, 2023 <i class="unloaded">2023-03-10T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Kafka Connect란</h3><div class="text-muted small"><p> 출처 https://cjw-awdsd.tistory.com/53 https://sihyung92.oopy.io/architecture/cdc https://hoing.io/archives/5285</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/%EC%9D%B4%ED%8E%99%ED%8B%B0%EB%B8%8C%EC%9E%90%EB%B0%94-%EC%95%84%EC%9D%B4%ED%85%9C89-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4-%EC%88%98%EB%A5%BC-%ED%86%B5%EC%A0%9C%ED%95%B4%EC%95%BC-%ED%95%9C%EB%8B%A4%EB%A9%B4-readResolve-%EB%B3%B4%EB%8B%A4%EB%8A%94-%EC%97%B4%EA%B1%B0-%ED%83%80%EC%9E%85%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%98%EB%9D%BC/" class="btn btn-outline-primary" prompt="Older"><p>[이펙티브자바] 아이템89-인스턴스 수를 통제해야 한다면 readResolve 보다는 열거 타입을 사용하라</p></a> <a href="/posts/Kafka-Connect-%EB%9E%80/" class="btn btn-outline-primary" prompt="Newer"><p>Kafka Connect란</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/jeonyoungho_o">jeonyoungho</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/effectivejava/">effectivejava</a> <a class="post-tag" href="/tags/react/">react</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/es6/">es6</a> <a class="post-tag" href="/tags/velopert/">velopert</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/poiemaweb/">poiemaweb</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://jeonyoungho.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
