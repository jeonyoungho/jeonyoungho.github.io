<!DOCTYPE html><html lang="ko" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="[JPA] QueryDSL" /><meta name="author" content="jeonyoungho" /><meta property="og:locale" content="ko" /><meta name="description" content="※ 실습 프로젝트는 Github에서 확인 할 수 있습니다." /><meta property="og:description" content="※ 실습 프로젝트는 Github에서 확인 할 수 있습니다." /><link rel="canonical" href="https://jeonyoungho.github.io/posts/QueryDSL/" /><meta property="og:url" content="https://jeonyoungho.github.io/posts/QueryDSL/" /><meta property="og:site_name" content="Youngho’s Devlog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-07-01T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[JPA] QueryDSL" /><meta name="twitter:site" content="@jeonyoungho_o" /><meta name="twitter:creator" content="@jeonyoungho" /><meta name="google-site-verification" content="eonGeSiIVfF48EnFoJqakC7h2hUzgqxFNJaxkfPiGr0" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"jeonyoungho"},"dateModified":"2021-07-01T00:00:00+09:00","datePublished":"2021-07-01T00:00:00+09:00","description":"※ 실습 프로젝트는 Github에서 확인 할 수 있습니다.","headline":"[JPA] QueryDSL","mainEntityOfPage":{"@type":"WebPage","@id":"https://jeonyoungho.github.io/posts/QueryDSL/"},"url":"https://jeonyoungho.github.io/posts/QueryDSL/"}</script><title>[JPA] QueryDSL | Youngho's Devlog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Youngho's Devlog"><meta name="application-name" content="Youngho's Devlog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-RF6ZGDWXV1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-RF6ZGDWXV1'); }); </script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5958719204143086" crossorigin="anonymous"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/youngho_employee_pic.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Youngho's Devlog</a></div><div class="site-subtitle font-italic">curios developer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/jeonyoungho" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/jeonyoungho_o" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['yhjun1000','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>[JPA] QueryDSL</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"> <ins class="adsbygoogle" style="display:block; margin-top: 30px;" data-ad-client="ca-pub-5958719204143086" data-ad-slot="1982371670" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[JPA] QueryDSL</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> jeonyoungho </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Jul 1, 2021, 12:00 AM +0900" prep="on" > Jul 1, 2021 <i class="unloaded">2021-07-01T00:00:00+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2805 words">15 min</span></div></div><div class="post-content"><p><b>※ 실습 프로젝트는 <a href="https://github.com/jeonyoungho/springboot-datajpa-querydsl">Github</a>에서 확인 할 수 있습니다.</b></p><h1 id="querydsl이란">QueryDSL이란?</h1><p><b>Querydsl 정적 타입을 이용해서 SQL과 같은 쿼리를 생성할 수 있도록 해 주는 프레임워크다.</b> 문자열로 작성하거나 XML 파일에 쿼리를 작성하는 대신, Querydsl이 제공하는 플루언트(Fluent) API를 이용해서 쿼리를 생성할 수 있다.</p><h1 id="querydsl를-사용해야-하는-이유">QueryDSL를 사용해야 하는 이유</h1><p><b>Querydsl은 타입에 안전한 방식(type-safe)으로 HQL 쿼리를 실행하기 위한 목적으로 만들어졌다.</b></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>try {
    
    tx = session.beginTransaction(); // create transaction
    Query&lt;Product&gt; theQuery = session.createQuery("from Product where id=:i", Product.class);
    theQuery.setParameter("i", 1);  

    List&lt;Product&gt; products = theQuery.getResultList(); 
    System.out.println("Total product size is " + products.size());
} catch (Exception ex) {
    ex.printStackTrace();
} finally {
    tx.commit(); // commit transaction
    session.close();
    sessionFactory.close();
}
</pre></table></code></div></div><p><b>만약 where조건에 있는 product_id컬럼을 product_id1으로 변경한다고 가정해보자. 개발자 입장에서는 프로그램을 실행 후 해당 쿼리가 실행되기 전까지는 오류를 발견할 수 가 없다.</b> 소프트웨어의 요구사항은 계속해서 바뀌며 개발도중에 DB스키마도 수시로 변경될 가능성이 크다. 그때마다 관련 쿼리가 문제 없는지 확인하는 과정은 생산성을 떨어뜨리며 실수하기도 쉽다.</p><p>QueryDSL을 사용한다면 Entity 도메인 객체에 수정이 일어나면 관련된 쿼리 코드에 컴파일 에러가 발생하게 된다. 컴파일 에러가 발생하는 코드를 수정하고 컴파일 에러가 없어진다면 적어도 소프트웨어 동작중에 쿼리가 잘못되어 에러가 발생하는 경우는 없을 것이다. 이런걸 <code class="language-plaintext highlighter-rouge">Type safe(타입 안정성)</code> 하다고 한다.</p><p>이러한 타입 안정성은 소프트웨어 개발에서 아래와 같은 큰 이득을 준다. 1) <b>과감하게 도메인 타입의 리팩토링을 할 수 있게 되어 소프트웨어의 품질을 높일 수 있게 된다.</b> 2) 쿼리 작성 과정에서 코드 자동완성 기능을 사용함으로써 쿼리를 더 빠르고 안전하게 만들 수 있게 된다.</p><p>더 자세한 내용은 <a href="https://javaengine.tistory.com/entry/spring-data-jpa-querydsl-%EB%A1%9C-%EA%B0%9C%EB%B0%9C%ED%95%98%EA%B8%B0">여기</a>를 참고하자.</p><h1 id="querydsl-적용">QueryDSL 적용</h1><h2 id="1-gradle-설정gradle-50-이상--intellij-2020x-이상-사용시">1. gradle 설정(Gradle 5.0 이상 &amp; IntelliJ 2020.x 이상 사용시)</h2><p>최근 Gradle 버전이 계속 증가하면서 Querydsl의 Gradle Plugin이 해당 버전을 못쫓아가는 경우가 계속 발생한다. 그러다보니 계속해서 QClass 생성 방법이 변경되다보니 Gradle &amp; IntelliJ가 업데이트 될 때마다 새로운 설정 방법을 필요로 하게된다.</p><p>이로 인해 최근엔 Gradle의 <code class="language-plaintext highlighter-rouge">Annotation processor</code> 을 사용하는 방법을 많이 사용하고 있다.</p><p>QueryDSL gradle설정에 대한 상세한 설명은 <a href="http://honeymon.io/tech/2020/07/09/gradle-annotation-processor-with-querydsl.html">허니몬님의 블로그</a> 포스팅을 꼭 정독해보자.</p><blockquote><p><strong>Note</strong>: 아래는 Gradle Plugin이 필요 없는 설정 (build.gradle) 코드이다. 즉, com.ewerk.gradle.plugins.querydsl 플러그인 사용하지 않는다.</p></blockquote><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>dependencies {
    // QueryDSL
    implementation "com.querydsl:querydsl-jpa:${querydslVersion}"
    annotationProcessor(
            "javax.persistence:javax.persistence-api",
            "javax.annotation:javax.annotation-api",
            "com.querydsl:querydsl-apt:${querydslVersion}:jpa")
}

def generated='src/main/generated'
sourceSets {
    main.java.srcDirs += [ generated ]
}

tasks.withType(JavaCompile) {
    options.annotationProcessorGeneratedSourcesDirectory = file(generated)
}

clean.doLast {
    file(generated).deleteOnExit();
}
</pre></table></code></div></div><p>이것 이외에는 별도의 설정이 필요 없다. 이후부터는 Gradle Project (View -&gt; Tool Windows -&gt; Gradle Project)을 열어 Tasks -&gt; other -&gt; compileJava를 실행시키시면 src/main/generated에 Q클래스들이 생성됩니다.</p><p><img width="1437" alt="1" src="https://user-images.githubusercontent.com/44339530/132973125-81f95f93-96b4-487b-a1c8-7083d7ebd733.png" /></p><h2 id="2-java-config--기본-사용법">2. Java Config &amp; 기본 사용법</h2><p>먼저 Java 설정을 진행합니다.</p><h3 id="2-1-java-config">2-1. Java Config</h3><p>설정값을 모아둔 패키지()에 <code class="language-plaintext highlighter-rouge">QuerydslConfiguration</code>을 생성합니다.</p><p><img width="1071" alt="2" src="https://user-images.githubusercontent.com/44339530/132973226-5046396f-ce67-4d80-a597-f41620cbd628.png" /></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>@Configuration
public class QuerydslConfiguration {
    @PersistenceContext
    private EntityManager entityManager;

    @Bean
    public JPAQueryFactory jpaQueryFactory() {
        return new JPAQueryFactory(entityManager);
    }
}
</pre></table></code></div></div><p>위 설정으로 이 프로젝트에서는 어느 곳에서나 JPAQueryFactory를 주입 받아 Querydsl을 사용할 수 있게 된다.</p><h3 id="2-2-기본적인-사용법">2-2. 기본적인 사용법</h3><p>먼저 테스트로 사용할 Product 엔티티는 아래와 같다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre>@Entity
@Getter
@NoArgsConstructor
public class Product {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "product_id", nullable = false, updatable = false)
    private Long id;

    private String name;

    @JsonIgnoreProperties({"products"})
    @ManyToOne
    @JoinColumn(name="category_id")
    private Category category;

    public void setCategory(Category category) {
        this.category = category;
    }

    private String description;

    private int price;

    private String manufacturer;

    private int unitInStock;

    @Builder
    public Product(String name, Category category, String description, int price, String manufacturer, int unitInStock) {
        this.name = name;
        this.category = category;
        this.description = description;
        this.price = price;
        this.manufacturer = manufacturer;
        this.unitInStock = unitInStock;
    }
}
</pre></table></code></div></div><p>그리고 테스트로 데이터를 넣고, 검증할 Repository는 아래와 같다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>public interface ProductRepository extends JpaRepository&lt;Product, Long&gt; {
    Product findByName(String name);
}
</pre></table></code></div></div><p><b>여기서 Querydsl Repository를 하나 생성하겠습니다. QuerydslRepositorySupport클래스를 상속받으며 클래스명은 <i>ProductRepositorySupport</i> 이다.</b></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>@Repository
public class ProductRepositorySupport extends QuerydslRepositorySupport {

    private final JPAQueryFactory queryFactory;

    public ProductRepositorySupport(JPAQueryFactory queryFactory) {
        super(Product.class);
        this.queryFactory = queryFactory;
    }

    public List&lt;Product&gt; findByPrice(int price) {
        return queryFactory
                .selectFrom(product)
                .where(product.price.eq(price))
                .fetch();
    }
}
</pre></table></code></div></div><p><b>설정으로 Bean 등록된 queryFactory를 생성자 인잭션으로 주입 받아 사용한다.</b></p><p>실제 조회 메소드를 작성하다보면 아래와 같은 오류 메세지가 나온다.</p><p><img width="1111" alt="7" src="https://user-images.githubusercontent.com/44339530/132980084-81083d40-e105-4146-b827-019abe7e8abc.png" /></p><p>이건 Querydsl의 QClass인 product를 사용하고 싶은데 아직 찾을수 없다는 뜻이다. 두 가지를 확인 해볼 수 있다.</p><h4 id="1-qclass가-없는-경우">1) QClass가 없는 경우</h4><p>위에서 수행했던 Gradle Project (View -&gt; Tool Windows -&gt; Gradle Project)을 열어 Tasks -&gt; other -&gt; compileJava를 실행함으로써 QClass를 생성하여 해결한다.</p><h4 id="2-인텔리제이-설정-상의-오류">2) 인텔리제이 설정 상의 오류</h4><p>QClass는 생성되었으나 인텔리제이 static import설정이 안되있기에 그럴 수 있다. 아래 이미지와 같이 Add on-demand static import부분이 체크가 안되어있다면 체크하자.</p><p><img width="1256" alt="4" src="https://user-images.githubusercontent.com/44339530/132978256-90ad6521-880f-4ce7-b760-2593dc793559.png" /></p><p>컴파일 에러가 나지 않는 상태가 되었다면, 테스트 코드로 이 메소드가 정상작동하는지 테스트해보자.</p><h3 id="2-3-기본-사용법-테스트">2-3. 기본 사용법 테스트</h3><p>아래와 같이 테스트 코드를 작성해서 위에서 구현한 <code class="language-plaintext highlighter-rouge">findByPrice</code> 메소드를 검증해보자.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre>@ExtendWith(SpringExtension.class)
@SpringBootTest
public class ProductRepositorySupportTest {

    @Autowired
    private ProductRepository productRepository;

    @Autowired
    private ProductRepositorySupport productRepositorySupport;

    @AfterEach
    public void tearDown() throws Exception {
        productRepository.deleteAllInBatch();
    }

    @Test
    public void querydsl_기본_기능_확인() {
        final int price = 100;
        for(int i=0;i&lt;10;i++) {
            productRepository.save(Product.builder()
                    .name("TestProduct"+i)
                    .description("Best Prodcut!")
                    .category(null)
                    .price(price)
                    .manufacturer("Apple")
                    .unitInStock(10)
                    .build());
        }

        //when
        List&lt;Product&gt; result = productRepositorySupport.findByPrice(price);

        //then
        assertThat(result.size(), is(price));
        assertThat(result.get(0).getName(), is("TestProduct0"));
    }
}
</pre></table></code></div></div><p>10개의 “ProductTest”라는 name을 가진 Product들을 삽입하고 Querydsl로 만든 <code class="language-plaintext highlighter-rouge">findByPrice</code> 메소드로 조회시 정상적으로 결과가 나오는지 확인합니다.</p><p><img width="1141" alt="8" src="https://user-images.githubusercontent.com/44339530/132980149-975f19c1-aba3-433b-8bed-4746174654b9.png" /></p><p>Queyrdsl로 작성된 코드가 정상적으로 실행되는 것을 확인할 수 있다. 하지만! 여기서 끝이 아니라, 한 단계 더 나아가보자.</p><h2 id="3-spring-data-jpa-custom-repository-적용">3. Spring Data Jpa Custom Repository 적용</h2><p>위와 같은 방식으로 Querydsl을 사용할 수 있지만, 한가지 단점이 존재한다.</p><p>항상 2개의 Repository를 의존성으로 받아야한다는 것입니다.</p><p>Querydsl의 CustomRepository와 JpaRepository를 상속한 Repository가 기능을 나눠가졌기 때문이다.</p><p>이를 해결하기 위해 Spring Data Jpa에서는 Custom Repository를 JpaRepository 상속 클래스에서 사용할 수 있도록 기능을 지원합니다.</p><p>전체적인 그림은 아래와 같습니다.</p><p><img width="698" alt="스크린샷 2021-09-12 오후 5 21 49" src="https://user-images.githubusercontent.com/44339530/132979401-6e3cc0b5-3872-49f0-89b5-3dacd7ebae56.png" /></p><blockquote><p><strong>Note</strong>: <a href="https://docs.spring.io/spring-data/jpa/docs/2.1.3.RELEASE/reference/html/#repositories.custom-implementations">Spring Data 공식 문서</a>을 참고하시면 Custom Repository 내용이 나오니 자세히 읽어보면 된다.</p></blockquote><p>위와 같이 구성하면 ProductRepository에서 ProductRepositoryImpl 의 코드도 사용할 수 있다.</p><p>일종의 공식이라고 보면 되는데, <code class="language-plaintext highlighter-rouge">Custom</code>이 붙은 인터페이스를 상속한 <code class="language-plaintext highlighter-rouge">Impl</code> 클래스의 코드는 <code class="language-plaintext highlighter-rouge">Custom 인터페이스</code>를 상속한 <code class="language-plaintext highlighter-rouge">JpaRepository</code>에서도 사용할 수 있다.</p><blockquote><p><strong>Note</strong>: Custom과 Impl만 외워도 된다.</p></blockquote><p>직접 코드로 구현해보자.</p><p>먼저 <code class="language-plaintext highlighter-rouge">ProductRepository</code>와 같은 위치에 <code class="language-plaintext highlighter-rouge">ProductRepositoryCustom 인터페이스</code>와 <code class="language-plaintext highlighter-rouge">ProductRepositoryImpl클래스</code>를 생성한다.</p><p><img width="704" alt="6" src="https://user-images.githubusercontent.com/44339530/132979553-709f4128-23b1-49e4-88d0-53e2717a1ec6.png" /></p><p>그리고 <code class="language-plaintext highlighter-rouge">ProductRepositoryCustom</code> 인터페이스에 다음과 같은 코드를 추가합니다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>public interface ProductRepositoryCustom {
    List&lt;Product&gt; findByPrice(int price);
}
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">ProductRepositoryImpl</code> 클래스는 기존에 있던 <code class="language-plaintext highlighter-rouge">Support</code> 클래스 코드를 참고해서 구현합니다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>@RequiredArgsConstructor
public class ProductRepositoryImpl implements ProductRepositoryCustom {

    private final JPAQueryFactory queryFactory;

    @Override
    public List&lt;Product&gt; findByPrice(int price) {
        return queryFactory
                .selectFrom(product)
                .where(product.price.eq(price))
                .fetch();
    }
}
</pre></table></code></div></div><blockquote><p><strong>Note</strong>: 다른 블로그를 보시면 QuerydslSupport 상속 코드도 추가하는데, 페이징이 필요한게 아니라면 안해도 된다. 결국 JPAQueryFactory를 통해서 작동하기 때문이다.</p></blockquote><p>그리고 이 코드를 <code class="language-plaintext highlighter-rouge">ProductRepository</code>에서 쓸수 있게 상속 구조로 변경하자.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>public interface ProductRepository extends JpaRepository&lt;Product, Long&gt;, ProductRepositoryCustom {
    Product findByName(String name);
}
</pre></table></code></div></div><p>그럼 이 코드가 정상작동하는지 테스트 해보자.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>@Test
public void querydsl_Custom설정_기능_확인() {
    final int price = 100;
    for(int i=0;i&lt;10;i++) {
        productRepository.save(Product.builder()
                .name("TestProduct"+i)
                .description("Best Prodcut!")
                .category(null)
                .price(price)
                .manufacturer("Apple")
                .unitInStock(10)
                .build());
    }

    //when
    List&lt;Product&gt; result = productRepository.findByPrice(price);

    //then
    assertThat(result.size(), is(price));
    assertThat(result.get(0).getName(), is("TestProduct0"));
}
</pre></table></code></div></div><p>테스트 코드를 실행해보면 아래 이미지와 같이 성공하는 것을 확인할 수 있다.</p><p><img width="1205" alt="9" src="https://user-images.githubusercontent.com/44339530/132981247-761ae3a5-8314-4bc3-b778-431994d03d22.png" /></p><h2 id="4-상속구현-없는-repository">4. 상속/구현 없는 Repository</h2><p>마지막은 <a href="https://jojoldu.tistory.com/372">jojoldu 블로그</a>에서 가장 선호하는 방식인 <code class="language-plaintext highlighter-rouge">Querydsl만으로</code> Repository를 구성하는 방법이다. 아래처럼 <code class="language-plaintext highlighter-rouge">JPAQueryFactory</code> 만 있으면 Querdsl을 사용할 수 있다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>@RequiredArgsConstructor
@Repository
public class ProductQueryRepository {
    private final JPAQueryFactory queryFactory;

    public List&lt;Product&gt; findByPrice(int price) {
        return queryFactory
                .selectFrom(product)
                .where(product.price.eq(price))
                .fetch();
    }
}
</pre></table></code></div></div><ul><li>최소한의 Bean 등록을 위해 @Repository를 선언한다.<li>별도의 상속(extends) / 구현(implements) 없이 JPAQueryFactory 만 있으면 된다.<li>특정 Entity 만 사용해야한다는 제약도 없다.</ul><p>아래 테스트 코드를 실행해보자.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre>@Autowired
private ProductRepository productRepository;

@Autowired
private ProductQueryRepository productQueryRepository;

@Test
public void querydsl_기본_기능_확인2() {
    final int price = 100;
    for(int i=0;i&lt;10;i++) {
        productRepository.save(Product.builder()
                .name("TestProduct"+i)
                .description("Best Prodcut!")
                .category(null)
                .price(price)
                .manufacturer("Apple")
                .unitInStock(10)
                .build());
    }

    //when
    List&lt;Product&gt; result = productQueryRepository.findByPrice(price);

    //then
    assertThat(result.size(), is(price));
    assertThat(result.get(0).getName(), is("TestProduct0"));
}
</pre></table></code></div></div><p>테스트 코드를 실행해보면 아래 이미지와 같이 성공하는 것을 확인할 수 있다.</p><p><img width="1041" alt="10" src="https://user-images.githubusercontent.com/44339530/132981480-71ff5439-93f5-4676-b1c1-ccc606d4ab5c.png" /></p><p>Core 기능이 아닌 어드민/API 등에서 특정 Entity를 메인으로 확정할 수 없는 경우와 자주 변경되는 기능에 대해서는 위처럼 선언해서 사용하시면 심플하게 변경에 대응할 수 있다.</p><h2 id="5-주의-사항">5. 주의 사항</h2><p>Querydsl의 QClass를 담는 <code class="language-plaintext highlighter-rouge">src/main/generated</code>는 빌드시 자동 생성되는 파일들의 디렉토리이니 무조건 <code class="language-plaintext highlighter-rouge">.gitignore</code>에 추가해야 한다.</p><p><img width="878" alt="11" src="https://user-images.githubusercontent.com/44339530/132981548-a00f451b-a4ae-4daa-bcff-29176e018674.png" /></p><h4 id="출처">출처</h4><ul><li><a href="http://www.querydsl.com/static/querydsl/4.0.1/reference/ko-KR/html_single/">http://www.querydsl.com/static/querydsl/4.0.1/reference/ko-KR/html_single/</a><li><a href="https://velog.io/@tigger/QueryDSL">https://velog.io/@tigger/QueryDSL</a><li><a href="https://jojoldu.tistory.com/372">https://jojoldu.tistory.com/372</a><li><a href="https://bgpark.tistory.com/157">https://bgpark.tistory.com/157</a><li><a href="https://velog.io/@dreamh1123/Querydsl-setting-in-intellij">https://velog.io/@dreamh1123/Querydsl-setting-in-intellij</a><li><a href="https://www.inflearn.com/questions/44549">https://www.inflearn.com/questions/44549</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/backend/'>Backend</a>, <a href='/categories/jpa/'>JPA</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/spring/" class="post-tag no-text-decoration" >spring</a> <a href="/tags/jpa/" class="post-tag no-text-decoration" >jpa</a> <a href="/tags/querydsl/" class="post-tag no-text-decoration" >querydsl</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[JPA] QueryDSL - Youngho's Devlog&url=https://jeonyoungho.github.io/posts/QueryDSL/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[JPA] QueryDSL - Youngho's Devlog&u=https://jeonyoungho.github.io/posts/QueryDSL/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[JPA] QueryDSL - Youngho's Devlog&url=https://jeonyoungho.github.io/posts/QueryDSL/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5958719204143086" data-ad-slot="1982371670" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-5958719204143086" data-ad-slot="5918543412"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <script src="https://utteranc.es/client.js" repo="jeonyoungho/jeonyoungho.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Kafka-%EB%A9%94%EC%8B%9C%EC%A7%80-%EC%A0%84%EB%8B%AC-%EB%B3%B4%EC%9E%A5-%EB%B0%A9%EC%8B%9D/">Kafka 메시지 전달 보장 방식</a><li><a href="/posts/Transactional-Outbox-%ED%8C%A8%ED%84%B4/">Transactional Outbox 패턴</a><li><a href="/posts/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EC%9D%B8%EB%8D%B1%EC%8A%A4-%EC%A1%B0%EA%B0%81%ED%99%94/">데이터베이스 인덱스 조각화(Fragmentation)</a><li><a href="/posts/Kafka-DeadLetter-%EA%B4%80%EB%A6%AC/">Kafka DeadLetter 관리</a><li><a href="/posts/Redis-%ED%8A%B9%EC%A7%95/">Redis 특징</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/effectivejava/">effectivejava</a> <a class="post-tag" href="/tags/react/">react</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/es6/">es6</a> <a class="post-tag" href="/tags/velopert/">velopert</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/poiemaweb/">poiemaweb</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/JPA-%EC%A0%95%EB%A6%AC/"><div class="card-body"> <span class="timeago small" > Dec 1, 2021 <i class="unloaded">2021-12-01T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[JPA] JPA 정리</h3><div class="text-muted small"><p> 페치 조인의 한계 1) 페치 조인 대상에는 별칭(alias)을 줄 수 없다. 1 2 String query = "select t from Team t join fetch t.members as m" //as m 이라는 별칭(alias)는 fetch join에서 사용할 수 없다. 하이버네이트는 가능하지만, 가급적 사용을 하지 않는게 좋다 ...</p></div></div></a></div><div class="card"> <a href="/posts/Entity-Relationships%EA%B0%9C%EC%9A%94/"><div class="card-body"> <span class="timeago small" > Jul 1, 2021 <i class="unloaded">2021-07-01T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[JPA] JPA Entity Relationships</h3><div class="text-muted small"><p> Entity Relationships 총 4가지 타입이 존재 1) @OneToOne 2) @OneToMany, @ManyToOne 3) @ManyToMany 총 2가지 방향성이 존재 1) bidirectional(양방향) 2) unidirectional(단방...</p></div></div></a></div><div class="card"> <a href="/posts/JPA-vs-Hibernate/"><div class="card-body"> <span class="timeago small" > Jul 1, 2021 <i class="unloaded">2021-07-01T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[JPA] JPA vs Hibernate</h3><div class="text-muted small"><p> JPA vs Hibernate JPA(Java Persistence API): 구현물이 없는 인터페이스 Hibernate: JPA의 구현체 JPA만 가지고는 프로그래밍할 순 없고 Hibernate, EclipseLink, DataNucleus와 같은 구현체를 가지고 사용해야한다. SessionFactory(Hiber...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/N+1%EB%AC%B8%EC%A0%9C/" class="btn btn-outline-primary" prompt="Older"><p>[JPA] JPA N+1 문제</p></a> <a href="/posts/SpringDataJPA%EA%B0%9C%EC%9A%94/" class="btn btn-outline-primary" prompt="Newer"><p>[JPA] Spring Data JPA 개요</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/jeonyoungho_o">jeonyoungho</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/effectivejava/">effectivejava</a> <a class="post-tag" href="/tags/react/">react</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/es6/">es6</a> <a class="post-tag" href="/tags/velopert/">velopert</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/poiemaweb/">poiemaweb</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://jeonyoungho.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
