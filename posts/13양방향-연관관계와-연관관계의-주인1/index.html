<!DOCTYPE html><html lang="ko" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="[자바 ORM 표준 JPA 프로그래밍-기본편] 양방향 연관관계와 연관관계의 주인" /><meta name="author" content="jeonyoungho" /><meta property="og:locale" content="ko" /><meta name="description" content="본 포스팅은 인프러의 JPA 기본편을 수강하고 정리하는 내용입니다." /><meta property="og:description" content="본 포스팅은 인프러의 JPA 기본편을 수강하고 정리하는 내용입니다." /><link rel="canonical" href="https://jeonyoungho.github.io/posts/13%EC%96%91%EB%B0%A9%ED%96%A5-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84%EC%99%80-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84%EC%9D%98-%EC%A3%BC%EC%9D%B81/" /><meta property="og:url" content="https://jeonyoungho.github.io/posts/13%EC%96%91%EB%B0%A9%ED%96%A5-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84%EC%99%80-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84%EC%9D%98-%EC%A3%BC%EC%9D%B81/" /><meta property="og:site_name" content="Youngho’s Devlog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-26T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[자바 ORM 표준 JPA 프로그래밍-기본편] 양방향 연관관계와 연관관계의 주인" /><meta name="twitter:site" content="@jeonyoungho_o" /><meta name="twitter:creator" content="@jeonyoungho" /><meta name="google-site-verification" content="eonGeSiIVfF48EnFoJqakC7h2hUzgqxFNJaxkfPiGr0" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"jeonyoungho"},"dateModified":"2021-10-26T00:00:00+09:00","datePublished":"2021-10-26T00:00:00+09:00","description":"본 포스팅은 인프러의 JPA 기본편을 수강하고 정리하는 내용입니다.","headline":"[자바 ORM 표준 JPA 프로그래밍-기본편] 양방향 연관관계와 연관관계의 주인","mainEntityOfPage":{"@type":"WebPage","@id":"https://jeonyoungho.github.io/posts/13%EC%96%91%EB%B0%A9%ED%96%A5-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84%EC%99%80-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84%EC%9D%98-%EC%A3%BC%EC%9D%B81/"},"url":"https://jeonyoungho.github.io/posts/13%EC%96%91%EB%B0%A9%ED%96%A5-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84%EC%99%80-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84%EC%9D%98-%EC%A3%BC%EC%9D%B81/"}</script><title>[자바 ORM 표준 JPA 프로그래밍-기본편] 양방향 연관관계와 연관관계의 주인 | Youngho's Devlog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Youngho's Devlog"><meta name="application-name" content="Youngho's Devlog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-RF6ZGDWXV1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-RF6ZGDWXV1'); }); </script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5958719204143086" crossorigin="anonymous"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/youngho_employee_pic.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Youngho's Devlog</a></div><div class="site-subtitle font-italic">curios developer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/jeonyoungho" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/jeonyoungho_o" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['yhjun1000','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>[자바 ORM 표준 JPA 프로그래밍-기본편] 양방향 연관관계와 연관관계의 주인</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"> <ins class="adsbygoogle" style="display:block; margin-top: 30px;" data-ad-client="ca-pub-5958719204143086" data-ad-slot="1982371670" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[자바 ORM 표준 JPA 프로그래밍-기본편] 양방향 연관관계와 연관관계의 주인</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> jeonyoungho </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Oct 26, 2021, 12:00 AM +0900" prep="on" > Oct 26, 2021 <i class="unloaded">2021-10-26T00:00:00+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2783 words">15 min</span></div></div><div class="post-content"><p>본 포스팅은 인프러의 <a href="https://www.inflearn.com/course/ORM-JPA-Basic#">JPA 기본편</a>을 수강하고 정리하는 내용입니다.</p><hr /><h1 id="양방향-매핑">양방향 매핑</h1><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/138800532-dcf11b9f-4e2f-4ebf-9f89-d9078d119b01.png" alt="image" /></p><ul><li><code class="language-plaintext highlighter-rouge">테이블</code> 의 연관관계에는 외래키 하나로 양방향이 다 있는 것이다. (사실상 방향이란 개념 자체가 없다)<ul><li>Member에서 내가 속한 팀을 알고 싶으면 Member의 TEAM_ID(FK)와 TEAM의 TEAM_ID(PK)를 조인하면 됨<li>TEAM에서 속한 멤버들을 알고 싶으면 TEAM의 TEAM_ID(PK)와 Member의 TEAM_ID(FK)를 조인하면 됨</ul><li><code class="language-plaintext highlighter-rouge">객체</code> 는 양쪽으로 가려면 둘 다 레퍼런스를 가질 수 있는 필드를 추가해야 한다.</ul><p>Member 엔티티는 단방향과 동일하다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>@Entity
public class Member {
    @Id @GeneratedValue
    private Long id;
    @Column(name = "USERNAME")
    private String name;
    private int age;
    @ManyToOne
    @JoinColumn(name = "TEAM_ID")
    private Team team;
    …
</pre></table></code></div></div><p>Team 엔티티는 컬렉션 추가한다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>@Entity
public class Team {
    @Id @GeneratedValue
    private Long id;
    private String name;
    @OneToMany(mappedBy = "team")
    List&lt;Member&gt; members = new ArrayList&lt;Member&gt;();
    …
}
</pre></table></code></div></div><p>반대 방향으로 객체 그래프 탐색 할 수 있다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>//조회
Team findTeam = em.find(Team.class, team.getId());
int memberSize = findTeam.getMembers().size(); //역방향 조회
</pre></table></code></div></div><p>과연 양방향 매핑이 좋냐는 관점으로 봤을때 객체는 가급적이면 단방향이 좋다. 양방향으로하면 신경쓸게 점점 많기 때문이다.</p><h1 id="연관관계의-주인과-mappedby">연관관계의 주인과 mappedBy</h1><ul><li>mappedBy = JPA의 멘탈붕괴 난이도<li>mappedBy는 처음에는 이해하기 어렵다.<li><b>객체와 테이블간에 연관관계를 맺는 차이를 이해해야 한다.</b></ul><h1 id="객체와-테이블이-관계를-맺는-차이">객체와 테이블이 관계를 맺는 차이</h1><ul><li>객체 연관관계 = 2개 (양방향이라지만 실제로는 단방향 2개이다)<ul><li>회원 -&gt; 팀 연관관계 1개(단방향)<li>팀 -&gt; 회원 연관관계 1개(단방향)</ul><li>테이블 연관관계 = 1개<ul><li>회원 &lt;-&gt; 팀의 연관관계 1개(양방향)<li>외래키 하나로 양쪽의 데이터들을 모든걸 조회할 수 있음<li>사실은 방향이 없는거임</ul></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/138803212-c76bbd12-375d-45fc-96c8-a39565b41e2d.png" alt="image" /></p><ul><li><b>객체의 양방향 관계는 사실 양방향 관계가 아니라 서로 다른 단 뱡향 관계 2개다.</b><li>객체를 양방향으로 참조하려면 단방향 연관관계를 2개 만들어 야 한다.<li>A -&gt; B (a.getB())<li>B -&gt; A (b.getA())</ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>class A {
    B b;
}

class B {
    A a;
}
</pre></table></code></div></div><ul><li><b>테이블은 외래 키 하나로 두 테이블의 연관관계를 관리</b><li>MEMBER.TEAM_ID 외래 키 하나로 양방향 연관관계 가짐(양쪽으로 조인할 수 있다.)</ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>SELECT *
FROM MEMBER M
JOIN TEAM T ON M.TEAM_ID = T.TEAM_ID

SELECT *
FROM TEAM T
JOIN MEMBER M ON T.TEAM_ID = M.TEAM_ID
</pre></table></code></div></div><h1 id="둘-중-하나로-외래-키를-관리해야-한다">둘 중 하나로 외래 키를 관리해야 한다.</h1><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/138803379-8df9f096-71ac-401b-b0c4-15186c2b7525.png" alt="image" /></p><ul><li>둘 중에 어떤걸로 매핑을 해야되는지 딜레마가 온다.<ul><li><code class="language-plaintext highlighter-rouge">Member</code> 객체의 Team 값을 변경했을때 외래키값이 업데이트되야하나<li><code class="language-plaintext highlighter-rouge">Team</code> 객체의 members 값을 변경했을때 외래키값이 업데이트되야하나</ul></ul><p>DB 입장에선 TEAM_ID(FK) 값만 업데이트되면 되는데 어떤걸로(Team이나 Member) 관리를 할지 주인을 정해야 한다.</p><h1 id="연관관계의-주인owner">연관관계의 주인(Owner)</h1><h2 id="양방향-매핑-규칙">양방향 매핑 규칙</h2><ul><li><b>객체의 두 관계중 하나를 연관관계의 주인으로 지정</b><li><b>연관관계의 주인만이 외래 키를 관리(등록, 수정)</b><li><b>주인이 아닌쪽은 읽기만 가능(꼭 기억하자!)</b><li>주인은 mappedBy 속성 사용X<li>주인이 아니면 mappedBy 속성으로 주인 지정</ul><h1 id="누구를-주인으로-중요">누구를 주인으로? (중요)</h1><ul><li><b>외래 키가 있는 있는 곳을 주인으로 정해라</b><ul><li>단순한 가이드이다.<li><code class="language-plaintext highlighter-rouge">ManyToOne</code> 의 <code class="language-plaintext highlighter-rouge">Many(다)</code> 쪽이 <code class="language-plaintext highlighter-rouge">연관관계의 주인</code> 으로 하면 된다.<li>만약 Team을 주인으로 한다고 가정했을 때, Team의 memebers값이 변경됐는데 Member테이블이 업데이트가 일어난다? 문제가 발생하기 마련이다.<li>Many쪽을 주인으로 해야 설계가 깔끔하게 들어간다.<li>외래키가 존재하는 엔티티에서 관리를 해야 나중에 문제도 발생하지 않는다.</ul><li>여기서는 <code class="language-plaintext highlighter-rouge">Member.team</code>이 연관관계의 주인</ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/138803961-f4aeb4b4-a44c-4f24-9939-858a2a2ec853.png" alt="image" /></p><h1 id="양방향-매핑시-가장-많이-하는-실수">양방향 매핑시 가장 많이 하는 실수</h1><p><b>연관관계의 주인에 값을 입력하지 않는 경우이다.</b></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>Team team = new Team();
team.setName("TeamA");
em.persist(team);

Member member = new Member();
member.setName("member1");

//역방향(주인이 아닌 방향)만 연관관계 설정
team.getMembers().add(member);

em.persist(member);
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/138810711-fc98b400-3669-4995-a9a7-b9e08f151da5.png" alt="image" /></p><p>mappedBy 속성이 지정된 가짜 매핑은 단순한 <code class="language-plaintext highlighter-rouge">읽기 전용</code> 이므로 실제 DB에 반영되지 않는다. 양방향 매핑시 연관관계의 주인에 값을 입력해야 한다. <b>순수한 객체 관계를 고려하면 항상 양쪽다 값을 입력해야 한다.</b></p><p>객체지향적으로 생각해보면 양쪽에 다 값을 걸어야 한다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>Team team = new Team();
team.setName("TeamA");
em.persist(team);

Member member = new Member();
member.setName("member1");

team.getMembers().add(member);
//연관관계의 주인에 값 설정
member.setTeam(team); //**

em.persist(member);
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/138811402-43a450eb-7f71-4873-a3f8-482370962070.png" alt="image" /></p><p>위의 코드처럼 진짜 주인(Member)에 설정을 해야 DB에 반영된다.</p><h2 id="양쪽다-값을-입력하지-않는-경우">양쪽다 값을 입력하지 않는 경우</h2><p>총 2가지 문제가 발생한다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>//팀 저장
Team team = new Team();
team.setName("TeamA");
em.persist(team);

//회원 저장
Member member = new Member();
member.setUsername("member1");
member.setTeam(team);
em.persist(member);

Team findTeam = em.find(Team.class, team.getId()); // 1차 캐시
List&lt;Member&gt; members = findTeam.getMembers();

for (Member m : members) {
    System.out.println("m = " + m.getUsername());
}

tx.commit();
</pre></table></code></div></div><p>1) 만약 One쪽인 Team에 값을 걸지 않는 경우 Team클래스는 <code class="language-plaintext highlighter-rouge">1차 캐시</code> 로 부터 엔티티를 가져와서 사용하게 되는데 그러면 <code class="language-plaintext highlighter-rouge">List&lt;Member&gt;</code> 에는 값이 없게 된다.</p><p>2) <code class="language-plaintext highlighter-rouge">테스트 케이스 작성</code> 할 때 JPA없이 동작하도록 순수하게 자바 코드 상태로 작성한다. 그 케이스에도 <code class="language-plaintext highlighter-rouge">Member.getTeam()</code> 이 되는데 반대로 <code class="language-plaintext highlighter-rouge">Team.getMembers()</code> 하면 Null이 나오게 되어 문제가 발생한다.</p><blockquote><p><strong>Note</strong>: 추가적으로 persist()로 member를 저장 후 flush와 clear를 수행하면 <code class="language-plaintext highlighter-rouge">1차 캐시</code> 가 아닌 <code class="language-plaintext highlighter-rouge">실제 DB</code>로부터 가져오게 된다. 이땐 정상적으로 지연로딩을 통해 값을 불러올 수 있다.</p></blockquote><h2 id="양방향-연관관계-주의---실습">양방향 연관관계 주의 - 실습</h2><ul><li><b>순수 객체 상태를 고려해서 항상 양쪽에 값을 설정하자</b><li><code class="language-plaintext highlighter-rouge">연관관계 편의 메소드</code> 를 생성하자<ul><li><code class="language-plaintext highlighter-rouge">member.setTeam(team);</code> 와 <code class="language-plaintext highlighter-rouge">team.getMembers().add(member);</code>를 항상 두 개 너어야하는데 사람이란게 실수하기 마련이다.<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>  @Entity
  public class Member {
  ...
        
  @ManyToOne
  @JoinColumn(name = "TEAM_ID")
  private Team team;

  public Team getTeam() {
      return team;
  }

  public void changeTeam(Team team) {
      this.team = team;
      team.getMembers().add(this);
  }
</pre></table></code></div></div><li>이처럼 진짜 주인에 값을 넣을때 자동으로 가짜 주인에도 넣을 수 있도록 편의 메소드를 활용하자<li>연관관계 편의 메서드나 JPA상태를 변경하는건 setter 를 활용하지 않는다.<li>이는 단순하게 getter setter 관례에 의한게 아니라 어떤 작업을 수행하는지 명확하게 알 수 있어 좋다.<li>예를 들어, <code class="language-plaintext highlighter-rouge">setTeam()</code> setter메서드로 수행하면 단순하게 Team만 설정하는 것 같다. 하지만 <code class="language-plaintext highlighter-rouge">changeTeam()</code> 메서드로 수행하면 명확하게 추가적인 로직이 들어가겠구나란걸 알 수 있다.<li><code class="language-plaintext highlighter-rouge">Team.addMember()</code> 메서드를 추가해서 <code class="language-plaintext highlighter-rouge">member.setTeam(this); memebers.add(member)</code> 로직을 추가해도 상관없다. 즉, 연관관계 편의 메서드는 일에 넣어도 되고 다에 넣어도 된다. 실제 애플리케이션 개발할 때의 상황보고 정하면 된다.</ul><li><b>양방향 매핑시에 무한 루프를 조심하자</b><ul><li><b>예: toString(), lombok, JSON 생성 라이브러리 =&gt; entity를 컨트롤러에서 response로 직접 보낼때</b><li><code class="language-plaintext highlighter-rouge">lombok</code> 에서 toString() 만드는거 왠만하면 쓰지말고 혹시 써도 위와 같은건 빼고써라<li><code class="language-plaintext highlighter-rouge">JSON 생성 라이브러리</code> 와 관련해서 컨트롤러에서 entity를 절대 반환하지 마라. 왠만하면 DTO로 변환해서 반환해라. entity를 반환할 경우 2가지 문제 소지가 있다.<ul><li>1)무한루프 문제가 생길 수 있다<li>2)나중에 entity를 변경하는 순간 api 스펙이 바껴버린다</ul></ul></ul><h1 id="양방향-매핑-정리">양방향 매핑 정리</h1><ul><li><b>단방향 매핑만으로도 이미 연관관계 매핑은 완료(중요!!!)</b><ul><li>JPA 모델링할때 단방향 매핑으로 처음에 설계를 끝내야함(양방향 매핑 하면 안됨)<li>처음에 설계를 할 때 주문시스템이다하면 연관된 테이블이 엄청 많을 것이다(많으면 100개)<li>실무에선 사실 객체만으로 설계할 수 없다. 테이블 설계를 먼저 그리면서 객체 설계를 같이 들어가야 한다.<li>그 시점에 테이블 관계에서 대략적인 foreign key가 나온다. 결국 Many(다) 쪽에서 단방향 매핑(ManyToOne, OneToOne)을 다 걸어서 들어가야 하는데 이때 양방향 매핑을 하지마라.<li><b>처음엔 무조건 단방향 매핑으로 설계를 끝내고, 그리고 나서 반대방향으로 조회 기능이 필요할 때 양방향을 사용해라.</b><li>JPA를 쓸때 객체랑 테이블을 설계하는 것은 단방향 매핑만으로 이미 완료가 된 것이다.</ul><li>양방향 매핑은 반대 방향으로 조회(객체 그래프 탐색) 기능이 추가된 것 뿐<li>JPQL에서 역방향으로 탐색할 일이 많음<li><b>단방향 매핑을 잘 하고 양방향은 필요할 때 추가해도 됨(중요!!!!)</b><ul><li>테이블에 영향을 주지 않는다.<li>테이블 손댈 필요없이 엔티티에 코드 몇 줄만 추가하면 된다. 큰 노고가 들어가지 않는다.</ul></ul><h1 id="정리">정리</h1><h2 id="jpa-사용시-엔티티-설계-할-때">JPA 사용시 엔티티 설계 할 때</h2><p>1) 단방향 매핑으로 다끝낸다.</p><p>2) <code class="language-plaintext highlighter-rouge">일대다</code> 일때 <code class="language-plaintext highlighter-rouge">다</code> 쪽에 연관관계 매핑을 전부 설정해주고 설계를 끝낸다.</p><p>3) 실제 애플리케이션 개발하는 단계에서 양방향 매핑을 고려한다.</p><ul><li>객체 입장에서 양방향 매핑이란게 별로 크게 이득이 되는게 없다.</ul><h2 id="연관관계의-주인을-정하는-기준">연관관계의 주인을 정하는 기준</h2><ul><li>비즈니스 로직을 기준으로 연관관계의 주인을 선택하면 안됨<li><b>연관관계의 주인은 실제 테이블의 외래 키 위치를 기준으로 정해야함</b></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/backend/'>Backend</a>, <a href='/categories/jpa/'>JPA</a>, <a href='/categories/%EC%9D%B8%ED%94%84%EB%9F%B0jpa-%EA%B8%B0%EB%B3%B8%ED%8E%B8/'>인프런JPA-기본편</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a> <a href="/tags/spring/" class="post-tag no-text-decoration" >spring</a> <a href="/tags/jpa/" class="post-tag no-text-decoration" >jpa</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[자바 ORM 표준 JPA 프로그래밍-기본편] 양방향 연관관계와 연관관계의 주인 - Youngho's Devlog&url=https://jeonyoungho.github.io/posts/13%EC%96%91%EB%B0%A9%ED%96%A5-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84%EC%99%80-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84%EC%9D%98-%EC%A3%BC%EC%9D%B81/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[자바 ORM 표준 JPA 프로그래밍-기본편] 양방향 연관관계와 연관관계의 주인 - Youngho's Devlog&u=https://jeonyoungho.github.io/posts/13%EC%96%91%EB%B0%A9%ED%96%A5-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84%EC%99%80-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84%EC%9D%98-%EC%A3%BC%EC%9D%B81/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[자바 ORM 표준 JPA 프로그래밍-기본편] 양방향 연관관계와 연관관계의 주인 - Youngho's Devlog&url=https://jeonyoungho.github.io/posts/13%EC%96%91%EB%B0%A9%ED%96%A5-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84%EC%99%80-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84%EC%9D%98-%EC%A3%BC%EC%9D%B81/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5958719204143086" data-ad-slot="1982371670" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-5958719204143086" data-ad-slot="5918543412"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <script src="https://utteranc.es/client.js" repo="jeonyoungho/jeonyoungho.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Kafka-%EB%A9%94%EC%8B%9C%EC%A7%80-%EC%A0%84%EB%8B%AC-%EB%B3%B4%EC%9E%A5-%EB%B0%A9%EC%8B%9D/">Kafka 메시지 전달 보장 방식</a><li><a href="/posts/Transactional-Outbox-%ED%8C%A8%ED%84%B4/">Transactional Outbox 패턴</a><li><a href="/posts/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EC%9D%B8%EB%8D%B1%EC%8A%A4-%EC%A1%B0%EA%B0%81%ED%99%94/">데이터베이스 인덱스 조각화(Fragmentation)</a><li><a href="/posts/Kafka-DeadLetter-%EA%B4%80%EB%A6%AC/">Kafka DeadLetter 관리</a><li><a href="/posts/Redis-%ED%8A%B9%EC%A7%95/">Redis 특징</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/effectivejava/">effectivejava</a> <a class="post-tag" href="/tags/react/">react</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/es6/">es6</a> <a class="post-tag" href="/tags/velopert/">velopert</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/poiemaweb/">poiemaweb</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/1%EA%B0%95%EC%A2%8C-%EC%86%8C%EA%B0%9C/"><div class="card-body"> <span class="timeago small" > Oct 22, 2021 <i class="unloaded">2021-10-22T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[자바 ORM 표준 JPA 프로그래밍-기본편] 강좌 소개</h3><div class="text-muted small"><p> 본 포스팅은 인프러의 JPA 기본편을 수강하고 정리하는 내용입니다. JPA? - Java Persistance API Jdbc -&gt; MyBatis, JdbcTemplate -&gt; JPA 과거에는 JdbcTemplate이나 MyBatis를 통해 sql을 한땀한땀 작성하여 개발을 했으나 이는 개발 생산성이 뒤떨어진다. JPA를 사용하면 ...</p></div></div></a></div><div class="card"> <a href="/posts/2SQL-%EC%A4%91%EC%8B%AC%EC%A0%81%EC%9D%B8-%EA%B0%9C%EB%B0%9C%EC%9D%98-%EB%AC%B8%EC%A0%9C%EC%A0%90/"><div class="card-body"> <span class="timeago small" > Oct 22, 2021 <i class="unloaded">2021-10-22T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[자바 ORM 표준 JPA 프로그래밍-기본편] SQL 중심적인 개발의 문제점</h3><div class="text-muted small"><p> 본 포스팅은 인프러의 JPA 기본편을 수강하고 정리하는 내용입니다. 대부분의 기업들은 객체 지향 언어(java, scala)를 사용한다. 또한 DB로는 관계형 DB를 많이 사용하고 있다. 그래서 지금 시대는 객체를 관계형 DB에 관리하는 시대이다. 문제는 애플리케이션은 객체 지향 개발하면서 하는데 딱 코드를 까보면 SQL만 천지이다. 결국엔 ...</p></div></div></a></div><div class="card"> <a href="/posts/3JPA-%EC%86%8C%EA%B0%9C/"><div class="card-body"> <span class="timeago small" > Oct 25, 2021 <i class="unloaded">2021-10-25T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[자바 ORM 표준 JPA 프로그래밍-기본편] JPA 소개</h3><div class="text-muted small"><p> 본 포스팅은 인프러의 JPA 기본편을 수강하고 정리하는 내용입니다. JPA란? Java Persistence API의 준말 자바 진영의 ORM 기술 표준 ORM이란? Object-relational mapping(객체 관계 매핑) 객체는 객체대로 설계 관계형 데이터베이스는 관계형 데이터베이스대로 설...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/12%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EB%A7%A4%ED%95%91-%EA%B8%B0%EC%B4%88/" class="btn btn-outline-primary" prompt="Older"><p>[자바 ORM 표준 JPA 프로그래밍-기본편] 연관관계 매핑 기초</p></a> <a href="/posts/14%EC%8B%A4%EC%A0%84-%EC%98%88%EC%A0%9C2-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EB%A7%A4%ED%95%91-%EC%8B%9C%EC%9E%91/" class="btn btn-outline-primary" prompt="Newer"><p>[자바 ORM 표준 JPA 프로그래밍-기본편] 실전 예제2 - 연관관계 매핑 시작</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/jeonyoungho_o">jeonyoungho</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/effectivejava/">effectivejava</a> <a class="post-tag" href="/tags/react/">react</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/es6/">es6</a> <a class="post-tag" href="/tags/velopert/">velopert</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/poiemaweb/">poiemaweb</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://jeonyoungho.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
