<!DOCTYPE html><html lang="ko" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Redis 동작 원리" /><meta name="author" content="jeonyoungho" /><meta property="og:locale" content="ko" /><meta name="description" content="Redis는 실무에서 캐싱, 동시성 문제 해결을 위한 분산 락, Rate Limit, 이벤트 Pub/Sub 모델 기반 브로드캐스팅 등 다양하게 활용되고 있다." /><meta property="og:description" content="Redis는 실무에서 캐싱, 동시성 문제 해결을 위한 분산 락, Rate Limit, 이벤트 Pub/Sub 모델 기반 브로드캐스팅 등 다양하게 활용되고 있다." /><link rel="canonical" href="https://jeonyoungho.github.io/posts/Redis-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC/" /><meta property="og:url" content="https://jeonyoungho.github.io/posts/Redis-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC/" /><meta property="og:site_name" content="Youngho’s Devlog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-05-01T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Redis 동작 원리" /><meta name="twitter:site" content="@jeonyoungho_o" /><meta name="twitter:creator" content="@jeonyoungho" /><meta name="google-site-verification" content="eonGeSiIVfF48EnFoJqakC7h2hUzgqxFNJaxkfPiGr0" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"jeonyoungho"},"dateModified":"2025-05-01T20:25:29+09:00","datePublished":"2025-05-01T00:00:00+09:00","description":"Redis는 실무에서 캐싱, 동시성 문제 해결을 위한 분산 락, Rate Limit, 이벤트 Pub/Sub 모델 기반 브로드캐스팅 등 다양하게 활용되고 있다.","headline":"Redis 동작 원리","mainEntityOfPage":{"@type":"WebPage","@id":"https://jeonyoungho.github.io/posts/Redis-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC/"},"url":"https://jeonyoungho.github.io/posts/Redis-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC/"}</script><title>Redis 동작 원리 | Youngho's Devlog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Youngho's Devlog"><meta name="application-name" content="Youngho's Devlog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-RF6ZGDWXV1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-RF6ZGDWXV1'); }); </script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5958719204143086" crossorigin="anonymous"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/youngho_employee_pic.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Youngho's Devlog</a></div><div class="site-subtitle font-italic">curios developer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/jeonyoungho" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/jeonyoungho_o" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['yhjun1000','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Redis 동작 원리</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"> <ins class="adsbygoogle" style="display:block; margin-top: 30px;" data-ad-client="ca-pub-5958719204143086" data-ad-slot="1982371670" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Redis 동작 원리</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> jeonyoungho </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, May 1, 2025, 12:00 AM +0900" prep="on" > May 1 <i class="unloaded">2025-05-01T00:00:00+09:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, May 1, 2025, 8:25 PM +0900" prefix="Updated " > May 1 <i class="unloaded">2025-05-01T20:25:29+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2533 words">14 min</span></div></div><div class="post-content"><p>Redis는 실무에서 캐싱, 동시성 문제 해결을 위한 분산 락, Rate Limit, 이벤트 Pub/Sub 모델 기반 브로드캐스팅 등 다양하게 활용되고 있다.</p><p>인메모리(RAM) 기반의 key-value 구조로 하드디스크로부터 조회하는 것에 비해 뛰어난 조회 성능을 가지고 있다. 또한, 싱글 스레드 기반으로 하나의 명령씩 실행이 가능하기에 동시성 문제를 해결하는데 효과적이다.</p><p>그렇다면 레디스는 내부적으로 어떻게 동작하며, 싱글 스레드 기반으로 높은 성능을 보장할 수 있는 것인지 알아보자.</p><h1 id="redis-내부-동작-메커니즘">Redis 내부 동작 메커니즘</h1><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/Backend/Redis동작원리_내부메커니즘.png" alt="Image" /> <em>출처: ByteByteGo</em></p><p>레디스의 전체적인 동작 메커니즘은 다음과 같다.</p><p><strong>1. Redis 기동 과정</strong></p><ul><li>Redis가 처음 기동하면 초기화 작업(설정 파일 로드, 메모리 할당, 데이터 구조 초기화 등)을 수행한다.<li>메인 스레드에서 이벤트 루프(Event Loop)를 생성후 초기화한다.<li>네트워크 소켓을 생성하고 지정된 포트(기본 6379)에서 클라이언트 연결을 대기한다.</ul><p><strong>2. 클라이언트 요청 처리</strong></p><ul><li>클라이언트가 Redis 서버의 IP와 포트로 TCP연결을 요청한다.<li>Redis 서버는 accept()를 통해 새로운 클라이언트 연결을 수락한다.<li>운영체제 커널을 통해 TCP 3-way handshake를 수행한다.<li>새로운 커넥션을 수립되면 클라이언트 소켓(소켓 디스크럽터)이 생성되고 I/O Multiplexing의 관찰 목록에 등록된다.<li>레디스는 I/O Multiplexing 을 통해 여러 파일 디스크럽트(소켓 디스크럽터)들의 이벤트 발생을 동시에 모니터링하며 발생된 이벤트들을 싱글 스레드로 처리한다.<li>싱글 스레드는 발생되는 이벤트(명령어)를 순차적으로 실행하며 결과를 클라이언트의 소켓에 응답을 씀(write)으로써 클라이언트에게 응답한다.</ul><p>조금 더 상세한 내용들을 아래에서 살펴보자.</p><h1 id="소켓socket">소켓(Socket)</h1><p>먼저 소켓과 관련된 자세한 내용은 아래 포스팅에 잘 정리되어있으니 참고하면 좋다.</p><ul><li><a href="https://velog.io/@newdana01/소켓이란-종류-통신-흐름-HTTP통신과의-차이">https://velog.io/@newdana01/소켓이란-종류-통신-흐름-HTTP통신과의-차이</a><li><a href="https://jaeseo0519.tistory.com/168">https://jaeseo0519.tistory.com/168</a></ul><p>소켓은 네트워크를 경유하는 프로세스 간 통신의 종착점이다. 전송 계층과 응용 프로그램 사이의 인터페이스 역할로써, 두 호스트를 연결해주는 역할을 한다.</p><h1 id="파일-디스크럽터file-descriptor">파일 디스크럽터(File Descriptor)</h1><p>파일 디스크럽터는 Linux, Unix 계열 시스템의 프로세스가 파일에 접근하기 위해 구분해놓은 정수값이다. 쉽게 표현하면 해시테이블에서 특정 파일에 접근하기 위한 키값과 같은 개념인 것이다.</p><p>프로세스별로 관리되며 기본적으로 0, 1, 2는 프로세스가 시작될때 기본적으로 할당되어 있다. 즉 새로운 파일 스크립터가 생성될때 3이상의 값부터 가지게 된다.</p><ul><li>fd 0 : 표준입력 (Standard Input)<li>fd 1 : 표준출력 (Standard Output)<li>fd 2 : 표준에러 (Standard Error)</ul><p>저수준 I/O 함수에게 파일 디스크립터를 전달하면, 해당 파일에 입출력을 진행한다.</p><p>보다 더 자세한 내용은 <a href="https://spongecake.tistory.com/112">여기</a>에 자세히 정리되어 있다.</p><h1 id="소켓socket과-파일-디스크럽터file-descriptor">소켓(Socket)과 파일 디스크럽터(File Descriptor)</h1><p>“<a href="https://en.wikipedia.org/wiki/Everything_is_a_file">모든 것이 파일이다(Everything is a file)</a>“는 유닉스/리눅스 철학의 핵심 개념 중 하나이다.</p><p>Socket도 서버와 클라이언트의 IP 주소, 포트 번호, 연결 상태 등을 기록해놓은 일종의 파일(File)이며, File Descriptor(FD, 파일 디스크립터)로 관리된다.</p><p><strong>하지만 더 정확히는 소켓 디스크립터는 실제 물리 파일이 아니다.</strong></p><p>소켓 디스크립터는 커널의 메모리(RAM) 영역에서 관리되는 프로세스(Redis 등)가 네트워크 연결을 참조할 수 있도록 하는 정수값 형태의 식별자이다. “모든 것이 파일이다” 라는 리눅스 철학을 바탕으로 파일 디스크럽터 형태로 해당 식별자가 관리되는 것일 뿐이다.</p><p>Redis가 이 소켓 디스크립터를 사용해 클라이언트와 통신할 때, 실제로는 RAM에 있는 이 데이터 구조를 통해 커널의 네트워크 스택과 상호작용하는 것이다.</p><p>따라서 저수준 I/O 함수를 기반으로 클라이언트/서버 간의 데이터 송·수신이 가능하게 되는 것이다.(ex. open(), close(), write(), read(), …)</p><h1 id="io-multiplexing멀티플랙싱">I/O Multiplexing(멀티플랙싱)</h1><p>먼저 멀티플랙싱은 하나의 통신 채널로 둘 이상의 데이터를 동시에 전송하는 네트워크상에서의 기술이다.</p><p>I/O 멀티플렉싱이란 싱글 스레드가 여러 I/O 작업을 동시에 모니터링 할 수 있도록 해주는 기술이다. 즉, 여러 파일 디스크립터(File Descriptor)의 I/O 상태를 하나의 호출로 확인할 수 있도록 해주는 것이다.</p><p>epoll(linux), kqueue(unix 계열), iocp(windows) 등의 운영체제의 시스템콜을 통해 구현된다.</p><h1 id="redis의-io-multiplexing멀티플랙싱">Redis의 I/O Multiplexing(멀티플랙싱)</h1><p>Redis가 싱글 스레드로 여러 클라이언트의 연결을 Non-Blocking I/O로 거의 동시에 처리하는 방법은 아래와 같다.</p><ul><li>클라이언트와 Redis가 통신할 때마다, Redis 호스트의 OS에는 소켓이 생성되고 각 소켓은 고유한 파일 디스크립터(FD)로 구분된다.(소켓은 os에서 네트워크 엔드포인트이므로)<li>클라이언트 연결 수락시 소켓을 epoll의 관찰 목록에 등록한다. 그리고 해당 소켓에 대한 읽기/쓰기 이벤트 모니터링을 시작한다.(물론 FD로 구분한다)<li>Redis의 메인 쓰레드에서 이벤트루프가 아래 절차로 수행된다.<ul><li>1)epoll_wait()로 이벤트 발생 감지<li>2)이벤트가 발생한 소켓들에 대해 차례로 처리</ul></ul><h1 id="redis의-이벤트-루프">Redis의 이벤트 루프</h1><p>Redis는 이벤트 처리를 위해 ae 라이브러리(Asynchronous Event library)를 사용한다.</p><p>Redis의 이벤트 루프 관련해서는 <a href="https://velog.io/@ohjinseo/Redis가-싱글-스레드-모델임에도-높은-성능을-보장하는-이유-IO-Multiplexing#-redis-event-loop">여기</a>에 잘 정리되어 있으며 아래 내용들은 전체적인 수준에서 이해하기 쉽도록 정리하였다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/Backend/Redis동작원리_이벤트루프.png" alt="Image" /> <em>출처: https://velog.io/@ohjinseo/Redis가-싱글-스레드-모델임에도-높은-성능을-보장하는-이유-IO-Multiplexing#-redis-event-loop</em></p><p>이벤트 루프에서의 처리 과정은 다음과 같다.</p><p><strong>1) 이벤트 루프 시작</strong></p><p><a href="https://github.com/redis/redis/blob/4979cf02ff83e90ced80db5111452a4c3e082c3a/src/ae.c#L495">aeMain()</a>함수를 통해 이벤트 루프가 무한 루프로 시작하며, 특정 플래그(stop)가 설정될 때까지 무한히 실행된다.</p><p><strong>2) 이벤트 폴링</strong></p><p><a href="https://github.com/redis/redis/blob/5fdaa53d20c82c99042e79b737fb9bc157a73d60/src/ae.c#L363">aeProcessEvents()</a>는 현재 발생할 수 있는 모든 이벤트(Time Events, File Events)를 처리하기 위해 호출된다. aeProcessEvents 함수는 aeApiPoll 함수를 호출하여 이벤트 폴링(epoll_wait[linux])을 수행하여 이벤트를 기다린다.</p><p><strong>3) 이벤트 발생</strong></p><p><a href="https://github.com/redis/redis/blob/4979cf02ff83e90ced80db5111452a4c3e082c3a/src/ae_epoll.c#L109">aeApiPoll()</a>에서 이벤트가 감지되면, 해당 이벤트에 연결된 fd와 이벤트 유형(AE_READABLE, AE_WRITABLE)가 eventLoop-&gt;fired 배열에 저장된다.</p><p><strong>4) 이벤트 처리</strong></p><p>그런 다음, aeProcessEvents()는 fired 배열을 순회하며 각 이벤트를 처리한다. 만약 발생한 이벤트가 AE_READABLE(클라이언트로부터 데이터가 도착)이라면 fe-&gt;rfileProc() 읽기 핸들러를 호출시켜 데이터를 읽고, AE_WRITABLE(데이터를 클라이언트에게 전송할 준비)이라면, fe-&gt;wfileProc() 쓰기 핸들러를 호출시켜 데이터를 클라이언트에게 전송한다.</p><p>실제 아래 <code class="language-plaintext highlighter-rouge">aeApiPoll()</code>에서 호출하는 <code class="language-plaintext highlighter-rouge">epoll()</code> (I/O Multiplexing 기술) 시스템 콜 덕분에, 싱글 스레드임에도 불구하고 다수의 연결과 요청을 비동기적으로 처리할 수 있게 되는 것이다.</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="k">static</span> <span class="kt">int</span> <span class="nf">aeApiPoll</span><span class="p">(</span><span class="n">aeEventLoop</span> <span class="o">*</span><span class="n">eventLoop</span><span class="p">,</span> <span class="k">struct</span> <span class="n">timeval</span> <span class="o">*</span><span class="n">tvp</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">aeApiState</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">eventLoop</span><span class="o">-&gt;</span><span class="n">apidata</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">retval</span><span class="p">,</span> <span class="n">numevents</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">retval</span> <span class="o">=</span> <span class="n">epoll_wait</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">epfd</span><span class="p">,</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">events</span><span class="p">,</span><span class="n">eventLoop</span><span class="o">-&gt;</span><span class="n">setsize</span><span class="p">,</span>
            <span class="n">tvp</span> <span class="o">?</span> <span class="p">(</span><span class="n">tvp</span><span class="o">-&gt;</span><span class="n">tv_sec</span><span class="o">*</span><span class="mi">1000</span> <span class="o">+</span> <span class="p">(</span><span class="n">tvp</span><span class="o">-&gt;</span><span class="n">tv_usec</span> <span class="o">+</span> <span class="mi">999</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">retval</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">j</span><span class="p">;</span>

        <span class="n">numevents</span> <span class="o">=</span> <span class="n">retval</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">numevents</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">mask</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">struct</span> <span class="n">epoll_event</span> <span class="o">*</span><span class="n">e</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">events</span><span class="o">+</span><span class="n">j</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">events</span> <span class="o">&amp;</span> <span class="n">EPOLLIN</span><span class="p">)</span> <span class="n">mask</span> <span class="o">|=</span> <span class="n">AE_READABLE</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">events</span> <span class="o">&amp;</span> <span class="n">EPOLLOUT</span><span class="p">)</span> <span class="n">mask</span> <span class="o">|=</span> <span class="n">AE_WRITABLE</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">events</span> <span class="o">&amp;</span> <span class="n">EPOLLERR</span><span class="p">)</span> <span class="n">mask</span> <span class="o">|=</span> <span class="n">AE_WRITABLE</span><span class="o">|</span><span class="n">AE_READABLE</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">events</span> <span class="o">&amp;</span> <span class="n">EPOLLHUP</span><span class="p">)</span> <span class="n">mask</span> <span class="o">|=</span> <span class="n">AE_WRITABLE</span><span class="o">|</span><span class="n">AE_READABLE</span><span class="p">;</span>
            <span class="n">eventLoop</span><span class="o">-&gt;</span><span class="n">fired</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">fd</span> <span class="o">=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">fd</span><span class="p">;</span>
            <span class="n">eventLoop</span><span class="o">-&gt;</span><span class="n">fired</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">retval</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">errno</span> <span class="o">!=</span> <span class="n">EINTR</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">panic</span><span class="p">(</span><span class="s">"aeApiPoll: epoll_wait, %s"</span><span class="p">,</span> <span class="n">strerror</span><span class="p">(</span><span class="n">errno</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">numevents</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><h1 id="정리">정리</h1><p>Redis의 세부적인 동작 메커니즘을 딥다이브 해보았다. 또한 I/O Multiplexing과 이벤트 루프를 통해 다수의 연결과 요청을 비동기적으로 처리함으로써 높은 처리 성능을 보장할 수 있다는 것을 확인할 수 있었다. 대용량 트래픽 처리에서 자주 사용되는 Redis의 이러한 동작 메커니즘을 한 번쯤은 깊이 있게 이해해보면 좋을 것 같다 :)</p><h1 id="reference">Reference</h1><ul><li><a href="https://velog.io/@qwerty1434/Redis는-Single-Thread임에도-불구하고-어떻게-작업을-빨리-처리할까">https://velog.io/@qwerty1434/Redis는-Single-Thread임에도-불구하고-어떻게-작업을-빨리-처리할까</a><li><a href="https://jaeseo0519.tistory.com/168">https://jaeseo0519.tistory.com/168</a><li><a href="https://incredible-larva.tistory.com/entry/IO-Multiplexing-톺아보기-1부">https://incredible-larva.tistory.com/entry/IO-Multiplexing-톺아보기-1부</a><li><a href="https://spongecake.tistory.com/112">https://spongecake.tistory.com/112</a><li><a href="https://haon.blog/redis/single-thread-fast/">https://haon.blog/redis/single-thread-fast/</a><li><a href="https://velog.io/@wken5577/IO-멀티플렉싱IO-Multiplexing">https://velog.io/@wken5577/IO-멀티플렉싱IO-Multiplexing</a><li><a href="https://velog.io/@rookie0031/Redis로-공부하는-CS">https://velog.io/@rookie0031/Redis로-공부하는-CS</a><li><a href="https://velog.io/@ohjinseo/Redis가-싱글-스레드-모델임에도-높은-성능을-보장하는-이유-IO-Multiplexing#-redis-event-loop">https://velog.io/@ohjinseo/Redis가-싱글-스레드-모델임에도-높은-성능을-보장하는-이유-IO-Multiplexing#-redis-event-loop</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/backend/'>Backend</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/redis/" class="post-tag no-text-decoration" >redis</a> <a href="/tags/socket/" class="post-tag no-text-decoration" >socket</a> <a href="/tags/io-multiplexing/" class="post-tag no-text-decoration" >io-multiplexing</a> <a href="/tags/eventloop/" class="post-tag no-text-decoration" >eventloop</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Redis 동작 원리 - Youngho's Devlog&url=https://jeonyoungho.github.io/posts/Redis-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Redis 동작 원리 - Youngho's Devlog&u=https://jeonyoungho.github.io/posts/Redis-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Redis 동작 원리 - Youngho's Devlog&url=https://jeonyoungho.github.io/posts/Redis-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5958719204143086" data-ad-slot="1982371670" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-5958719204143086" data-ad-slot="5918543412"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <script src="https://utteranc.es/client.js" repo="jeonyoungho/jeonyoungho.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Kafka-%EB%A9%94%EC%8B%9C%EC%A7%80-%EC%A0%84%EB%8B%AC-%EB%B3%B4%EC%9E%A5-%EB%B0%A9%EC%8B%9D/">Kafka 메시지 전달 보장 방식</a><li><a href="/posts/Transactional-Outbox-%ED%8C%A8%ED%84%B4/">Transactional Outbox 패턴</a><li><a href="/posts/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EC%9D%B8%EB%8D%B1%EC%8A%A4-%EC%A1%B0%EA%B0%81%ED%99%94/">데이터베이스 인덱스 조각화(Fragmentation)</a><li><a href="/posts/Kafka-DeadLetter-%EA%B4%80%EB%A6%AC/">Kafka DeadLetter 관리</a><li><a href="/posts/Redis-%ED%8A%B9%EC%A7%95/">Redis 특징</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/effectivejava/">effectivejava</a> <a class="post-tag" href="/tags/react/">react</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/es6/">es6</a> <a class="post-tag" href="/tags/velopert/">velopert</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/poiemaweb/">poiemaweb</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Redis-%ED%8A%B9%EC%A7%95/"><div class="card-body"> <span class="timeago small" > May 1 <i class="unloaded">2025-05-01T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Redis 특징</h3><div class="text-muted small"><p> Redis는 Remote Dictionary Server를 뜻하며 key-value 기반의 인메모리 데이터 저장소이다. 대용량 트래픽을 처리하기 위해 자주 사용되는 Redis의 대표적인 특징들을 알아보자. 1. key-value 구조의 비관계형 데이터베이스 RDB와는 다르게 관계가 없는 비정형 데이터를 관리한다. 2. 싱글 스레드 기반 Redis...</p></div></div></a></div><div class="card"> <a href="/posts/%EB%A1%9C%EB%93%9C-%EB%B0%B8%EB%9F%B0%EC%84%9C-%EC%82%AC%EC%9A%A9-%EC%8B%9C%EC%9D%98-%EC%9D%B4%EC%8A%88-%EC%A4%91-%EC%84%B8%EC%85%98-%EA%B4%80%EB%A6%AC-%EB%AC%B8%EC%A0%9C/"><div class="card-body"> <span class="timeago small" > Jun 30, 2021 <i class="unloaded">2021-06-30T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Backend] 로드 밸런서 사용 시의 이슈 중 세션 관리 문제</h3><div class="text-muted small"><p> 로드 밸런서 사용 시의 이슈 중 세션 관리 문제 로드 밸런서에 의해 이전 요청과 현 요청에 분배되는 서버가 다를 경우 세션 관리 일관성에 문제가 발생한다. 로드 밸런서 세션 관리 문제의 예시 1) 먼저 로그인 요청을 A서버로 보낸다. A서버의 세션에는 martin이라는 값이 저장되고 A서버에서는 로그인 성공이라는 응답을 보낸다. 2...</p></div></div></a></div><div class="card"> <a href="/posts/DB-Lock-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0-1%ED%8E%B8/"><div class="card-body"> <span class="timeago small" > Feb 22 <i class="unloaded">2025-02-22T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>DB Lock 알아보기 1편</h3><div class="text-muted small"><p> 제품을 운영하다보면 Deadlock found when trying to get lock, Lock wait timout exceeded와 같은 DB 동시성 이슈를 마주할 수 있게 된다. 보통 여러 트랜잭션이 동시에 동일 데이터에 대한 select, update 작업들을 수행할때 발생하게 되는데 이와 관련해서 DB Lock에 대해 정리해보고자 한다. ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/MSA-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C%EC%9D%98-%EB%B6%84%EC%82%B0-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EA%B4%80%EB%A6%AC/" class="btn btn-outline-primary" prompt="Older"><p>MSA 환경에서의 분산 트랜잭션 관리</p></a> <a href="/posts/Redis-%ED%8A%B9%EC%A7%95/" class="btn btn-outline-primary" prompt="Newer"><p>Redis 특징</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/jeonyoungho_o">jeonyoungho</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/effectivejava/">effectivejava</a> <a class="post-tag" href="/tags/react/">react</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/es6/">es6</a> <a class="post-tag" href="/tags/velopert/">velopert</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/poiemaweb/">poiemaweb</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://jeonyoungho.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
