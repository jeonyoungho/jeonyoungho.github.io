<!DOCTYPE html><html lang="ko" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="[자바 ORM 표준 JPA 프로그래밍-기본편] 영속성 컨텍스트" /><meta name="author" content="jeonyoungho" /><meta property="og:locale" content="ko" /><meta name="description" content="본 포스팅은 인프러의 JPA 기본편을 수강하고 정리하는 내용입니다." /><meta property="og:description" content="본 포스팅은 인프러의 JPA 기본편을 수강하고 정리하는 내용입니다." /><link rel="canonical" href="https://jeonyoungho.github.io/posts/4%EC%98%81%EC%86%8D%EC%84%9D-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8/" /><meta property="og:url" content="https://jeonyoungho.github.io/posts/4%EC%98%81%EC%86%8D%EC%84%9D-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8/" /><meta property="og:site_name" content="Youngho’s Devlog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-25T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[자바 ORM 표준 JPA 프로그래밍-기본편] 영속성 컨텍스트" /><meta name="twitter:site" content="@jeonyoungho_o" /><meta name="twitter:creator" content="@jeonyoungho" /><meta name="google-site-verification" content="eonGeSiIVfF48EnFoJqakC7h2hUzgqxFNJaxkfPiGr0" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"jeonyoungho"},"dateModified":"2021-10-25T00:00:00+09:00","datePublished":"2021-10-25T00:00:00+09:00","description":"본 포스팅은 인프러의 JPA 기본편을 수강하고 정리하는 내용입니다.","headline":"[자바 ORM 표준 JPA 프로그래밍-기본편] 영속성 컨텍스트","mainEntityOfPage":{"@type":"WebPage","@id":"https://jeonyoungho.github.io/posts/4%EC%98%81%EC%86%8D%EC%84%9D-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8/"},"url":"https://jeonyoungho.github.io/posts/4%EC%98%81%EC%86%8D%EC%84%9D-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8/"}</script><title>[자바 ORM 표준 JPA 프로그래밍-기본편] 영속성 컨텍스트 | Youngho's Devlog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Youngho's Devlog"><meta name="application-name" content="Youngho's Devlog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-RF6ZGDWXV1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-RF6ZGDWXV1'); }); </script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5958719204143086" crossorigin="anonymous"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/youngho_employee_pic.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Youngho's Devlog</a></div><div class="site-subtitle font-italic">curios developer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/jeonyoungho" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/jeonyoungho_o" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['yhjun1000','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>[자바 ORM 표준 JPA 프로그래밍-기본편] 영속성 컨텍스트</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"> <ins class="adsbygoogle" style="display:block; margin-top: 30px;" data-ad-client="ca-pub-5958719204143086" data-ad-slot="1982371670" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[자바 ORM 표준 JPA 프로그래밍-기본편] 영속성 컨텍스트</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> jeonyoungho </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Oct 25, 2021, 12:00 AM +0900" prep="on" > Oct 25, 2021 <i class="unloaded">2021-10-25T00:00:00+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1956 words">10 min</span></div></div><div class="post-content"><p>본 포스팅은 인프러의 <a href="https://www.inflearn.com/course/ORM-JPA-Basic#">JPA 기본편</a>을 수강하고 정리하는 내용입니다.</p><hr /><p>JPA에서 가장 중요한 2가지</p><ul><li>객체와 관게형 데이터베이스 매핑하기(Object Relational mapping)<ul><li>DB를 어떻게 설계하고 객체를 어떻게 설계해서 중간에 어떻게 JPA로 매핑해서 쓸건지</ul><li><b>영속성 컨텍스트</b><ul><li>실제 내부에서 JPA가 어떻게 동작하는지</ul></ul><h1 id="엔티티-매니저-팩토리와-엔티티-매니저">엔티티 매니저 팩토리와 엔티티 매니저</h1><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/138642126-a6b2a302-4d61-4800-a5d8-d02ae7f44a20.png" alt="image" /></p><p>EntityManagerFactory를 통해 고객의 요청이 올때마다 EntityManager를 생성하고 내부적으로 DB 커넥션을 사용해서 DB를 사용하게 된다.</p><h1 id="영속성-컨텍스트">영속성 컨텍스트</h1><ul><li>JPA를 이해하는데 가장 중요한 용어<li><code class="language-plaintext highlighter-rouge">엔티티를 영구 저장하는 환경</code> 이라는 뜻<li><code class="language-plaintext highlighter-rouge">EntityManager.persist(entity);</code><ul><li>persist() 메서드는 실제로 DB에 저장한다기보단 영속성 컨텍스트에 저장한다.</ul></ul><h1 id="엔티티-매니저-영속성-컨텍스트">엔티티 매니저? 영속성 컨텍스트?</h1><ul><li>영속성 컨텍스트는 논리적인 개념<li>눈에 보이지 않는다.<li>엔티티 매니저를 통해서 영속성 컨텍스트에 접근</ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/138642462-3a143516-a27a-454d-ad97-ed02d8419b0a.png" alt="image" /></p><p>EntityManager 를 생성하면 그안에 1대1로 PersistenceContext(영속성 컨텍스트)가 생성된다.</p><h1 id="엔티티의-생명주기">엔티티의 생명주기</h1><ul><li><code class="language-plaintext highlighter-rouge">비영속 (new/transient)</code><ul><li>영속성 컨텍스트와 전혀 관계가 없는 새로운 상태</ul><li><code class="language-plaintext highlighter-rouge">영속 (managed)</code><ul><li>영속성 컨텍스트에 관리되는 상태</ul><li><code class="language-plaintext highlighter-rouge">준영속 (detached)</code><ul><li>영속성 컨텍스트에 저장되었다가 분리된 상태</ul><li><code class="language-plaintext highlighter-rouge">삭제 (removed)</code><ul><li>삭제된 상태</ul></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/138642624-9e42b4d1-6b41-4ddf-abf1-6ca9058a3fc7.png" alt="image" /></p><h2 id="비영속비영속-newtransient">비영속(비영속 (new/transient))</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/138642687-93c36f92-dd69-4771-9336-1d081d3f01bd.png" alt="image" /></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>//객체를 생성한 상태(비영속)
Member member = new Member();
member.setId("member1");
member.setUsername("회원1");
</pre></table></code></div></div><p>일반적으로 객체를 생성 후 persist()메소드를 호출하지 않은 상태를 말한다.</p><h2 id="영속-managed"><code class="language-plaintext highlighter-rouge">영속 (managed)</code></h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/138642807-9e2a69a1-ad6a-43d0-9a4a-fd678db9f50b.png" alt="image" /></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>//객체를 생성한 상태(비영속)
Member member = new Member();
member.setId("member1");
member.setUsername(“회원1”);
EntityManager em = emf.createEntityManager();
em.getTransaction().begin();
//객체를 저장한 상태(영속)
em.persist(member);
</pre></table></code></div></div><p>생성한 객체를 영속성 컨텍스트에서 관리하고 있는 상태를 말한다. 영속 상태가 된다고 바로 DB에 쿼리가 날라가는게 아니라 커밋할 때 쿼리가 날라가 실제 DB에 반영된다.</p><h2 id="준영속-detached"><code class="language-plaintext highlighter-rouge">준영속 (detached)</code></h2><p>회원 엔티티를 영속성 컨텍스트에서 분리한 준영속 상태</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>em.detach(member);
</pre></table></code></div></div><h2 id="삭제-removed"><code class="language-plaintext highlighter-rouge">삭제 (removed)</code></h2><p>객체를 삭제한 상태(삭제)를 말한다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>em.remove(member);
</pre></table></code></div></div><h1 id="영속성-컨텍스트의-이점">영속성 컨텍스트의 이점</h1><p>애플리케이션과 RDB사이의 중간의 계층이다보니 버퍼링이나 캐슁을 할 수 있다.</p><ul><li>1)1차 캐시<li>2)동일성(identity) 보장<li>3)트랜잭션을 지원하는 쓰기 지연(transactional write-behind)<li>4)변경 감지(Dirty Checking)<li>5)지연 로딩(Lazy Loading)</ul><h2 id="1-1차-캐시">1. 1차 캐시</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/138643216-b76919dd-f799-4664-ab05-4e0b1e12493f.png" alt="image" /></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>//엔티티를 생성한 상태(비영속)
Member member = new Member();
member.setId("member1");
member.setUsername("회원1");
//엔티티를 영속
em.persist(member);
</pre></table></code></div></div><p>영속성 컨텍스트는 내부에 <code class="language-plaintext highlighter-rouge">1차 캐시</code> 라는 것을 두고 있다. @Id가 PK를 가지고 있고 , Entity가 객체 자체를 가리키게 된다.</p><h3 id="1차-캐시에서-조회">1차 캐시에서 조회</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/138643457-f12d4313-c1a6-43ba-871c-56bb2acce63c.png" alt="image" /></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>Member member = new Member();
member.setId("member1");
member.setUsername("회원1");
//1차 캐시에 저장됨
em.persist(member);
//1차 캐시에서 조회
Member findMember = em.find(Member.class, "member1");
</pre></table></code></div></div><p>Member 객체를 저장해놓고 조회를 하면 먼저 1차 캐시를 뒤진다. 그래서 1차 캐시에 존재하면 캐시에 있는 값을 그냥 조회해 온다. (훨씬 조회 속도가 빠르다) 만약 1차 캐시에 존재하지 않는다면 그 다음으로 DB에서 찾게 된다.</p><h3 id="데이터베이스에서-조회">데이터베이스에서 조회</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/138643795-484b2320-9f49-4d2b-9273-db4bf4c41f67.png" alt="image" /></p><p>만약 member2를 조회한다하면 1차 캐시에 없기에 DB에서 조회하게 된다. 찾은 데이터를 1차 캐시에 저장 후 반환하게 된다.</p><blockquote><p><strong>Note</strong>: 사실 이게 큰 도움은 안된다. 왜냐하면 EntityManager라는 것은 DB 트랜잭션 단위로 만들고 DB트랜잭션이 끝날때마다 삭제된다. 즉, 고객의 요청이 하나 들어와서 비즈니스가 끝나면 영속성 컨텍스트를 지운다. 굉장히 복잡할땐 도움이 될 수 있겠지만 일반적으로 굉장히 짧은 시간 동안 유지하기에 큰 도움은 없다고 볼 수 있다.</p></blockquote><h2 id="2-동일성identity-보장">2. 동일성(identity) 보장</h2><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>Member a = em.find(Member.class, "member1");
Member b = em.find(Member.class, "member1");
System.out.println(a == b); //동일성 비교 true
</pre></table></code></div></div><p>1차 캐시로 반복 가능한 읽기(REPEATABLE READ) 등급의 트랜잭션 격리 수준을 데이터베이스가 아닌 애플리케이션 차원에서 제공한다. 꼭 같은 트랜잭션 안에서만 적용된다.</p><h2 id="3-트랜잭션을-지원하는-쓰기-지연transactional-write-behind">3. 트랜잭션을 지원하는 쓰기 지연(transactional write-behind)</h2><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>EntityManager em = emf.createEntityManager();
EntityTransaction transaction = em.getTransaction();
//엔티티 매니저는 데이터 변경시 트랜잭션을 시작해야 한다.
transaction.begin(); // [트랜잭션] 시작
em.persist(memberA);
em.persist(memberB);
//여기까지 INSERT SQL을 데이터베이스에 보내지 않는다.
//커밋하는 순간 데이터베이스에 INSERT SQL을 보낸다.
transaction.commit(); // [트랜잭션] 커밋
</pre></table></code></div></div><p>내부적으로 버퍼를 가지고 있기에 버퍼에 쭉쭉 엔티티를 쌓다가 커밋하는 순간에 DB에 보낸다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/138645962-8068cb55-4d93-4f6b-b7b0-b65b415e3ec2.png" alt="image" /></p><p>영속성 컨텍스트는 내부적으로 1차 캐시 뿐만 아닌 <code class="language-plaintext highlighter-rouge">쓰기 지연 SQL 저장소</code>가 존재한다.</p><p>MemberA를 persist()메서드를 통해 저장하면 MemberA가 1차 캐시에 들어감과 동시에 JPA가 엔티티를 분석해서 insert쿼리를 생성해서 <code class="language-plaintext highlighter-rouge">쓰기 지연 SQL 저장소</code> 에 쌓아둔다.</p><p>MemberB를 저장해도 위처럼 동일하게 작동한다. 그렇다면 언제 쿼리가 DB로 날라가느냐?</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/138646278-7e3438ad-b7a2-4cfe-b3ec-0e0c4a79b085.png" alt="image" /></p><p>트랜잭션을 <code class="language-plaintext highlighter-rouge">커밋</code> 하는 시점에 <code class="language-plaintext highlighter-rouge">쓰기 지연 SQL 저장소</code>에 있던 쿼리들이 flush되면서 쿼리가 DB로 날라간다.</p><h2 id="4-변경-감지dirty-checking">4. 변경 감지(Dirty Checking)</h2><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>EntityManager em = emf.createEntityManager();
EntityTransaction transaction = em.getTransaction();
transaction.begin(); // [트랜잭션] 시작

// 영속 엔티티 조회
Member memberA = em.find(Member.class, "memberA");

// 영속 엔티티 데이터 수정
memberA.setUsername("hi");
memberA.setAge(10);

//em.update(member) 이런 코드가 있어야 하지 않을까? 없는게 맞다.

transaction.commit(); // [트랜잭션] 커밋
</pre></table></code></div></div><p>JPA는 변경 감지라는 기능으로 entity를 변경할 수 있는 기능이 제공된다. 자바 컬렉션처럼 데이터를 조회해서 값을 바꿔도 다시 persist()를 호출해서 저장할 필요가 없다. 비밀은 영속성 컨텍스트 안에 다 있다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/44339530/138649212-a2f38626-105f-44a0-8c71-54deb2514ca5.png" alt="image" /></p><p>JPA는 데이터 베이스 트랜잭션을 커밋하는 시점에 내부적으로 flush() 메서드가 호출된다. 그러면 <code class="language-plaintext highlighter-rouge">엔티티와 스냅샷을 비교(1차 캐시 안에 존재)</code> 한다. 1차 캐시는 엔티티가 처음 영속성 컨텍스트가 저장된 상태를 스냅샷에 저장한다. 비교 후 상태 값이 변경되었으면 update쿼리를 <code class="language-plaintext highlighter-rouge">쓰기 지연 SQL 저장소</code> 에 만들어두고 DB에 반영하고 커밋한다.</p><h2 id="5-엔티티-삭제">5. 엔티티 삭제</h2><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>//삭제 대상 엔티티 조회 (위의 매커니즘과 동일하고 트랜잭션 커밋 시점에 delete 쿼리가 호출된다)
Member memberA = em.find(Member.class, “memberA");

em.remove(memberA); //엔티티 삭제
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/backend/'>Backend</a>, <a href='/categories/jpa/'>JPA</a>, <a href='/categories/%EC%9D%B8%ED%94%84%EB%9F%B0jpa-%EA%B8%B0%EB%B3%B8%ED%8E%B8/'>인프런JPA-기본편</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a> <a href="/tags/spring/" class="post-tag no-text-decoration" >spring</a> <a href="/tags/jpa/" class="post-tag no-text-decoration" >jpa</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[자바 ORM 표준 JPA 프로그래밍-기본편] 영속성 컨텍스트 - Youngho's Devlog&url=https://jeonyoungho.github.io/posts/4%EC%98%81%EC%86%8D%EC%84%9D-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[자바 ORM 표준 JPA 프로그래밍-기본편] 영속성 컨텍스트 - Youngho's Devlog&u=https://jeonyoungho.github.io/posts/4%EC%98%81%EC%86%8D%EC%84%9D-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[자바 ORM 표준 JPA 프로그래밍-기본편] 영속성 컨텍스트 - Youngho's Devlog&url=https://jeonyoungho.github.io/posts/4%EC%98%81%EC%86%8D%EC%84%9D-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5958719204143086" data-ad-slot="1982371670" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-5958719204143086" data-ad-slot="5918543412"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <script src="https://utteranc.es/client.js" repo="jeonyoungho/jeonyoungho.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Kafka-%EB%A9%94%EC%8B%9C%EC%A7%80-%EC%A0%84%EB%8B%AC-%EB%B3%B4%EC%9E%A5-%EB%B0%A9%EC%8B%9D/">Kafka 메시지 전달 보장 방식</a><li><a href="/posts/Transactional-Outbox-%ED%8C%A8%ED%84%B4/">Transactional Outbox 패턴</a><li><a href="/posts/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EC%9D%B8%EB%8D%B1%EC%8A%A4-%EC%A1%B0%EA%B0%81%ED%99%94/">데이터베이스 인덱스 조각화(Fragmentation)</a><li><a href="/posts/Kafka-DeadLetter-%EA%B4%80%EB%A6%AC/">Kafka DeadLetter 관리</a><li><a href="/posts/Redis-%ED%8A%B9%EC%A7%95/">Redis 특징</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/effectivejava/">effectivejava</a> <a class="post-tag" href="/tags/react/">react</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/es6/">es6</a> <a class="post-tag" href="/tags/velopert/">velopert</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/poiemaweb/">poiemaweb</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/1%EA%B0%95%EC%A2%8C-%EC%86%8C%EA%B0%9C/"><div class="card-body"> <span class="timeago small" > Oct 22, 2021 <i class="unloaded">2021-10-22T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[자바 ORM 표준 JPA 프로그래밍-기본편] 강좌 소개</h3><div class="text-muted small"><p> 본 포스팅은 인프러의 JPA 기본편을 수강하고 정리하는 내용입니다. JPA? - Java Persistance API Jdbc -&gt; MyBatis, JdbcTemplate -&gt; JPA 과거에는 JdbcTemplate이나 MyBatis를 통해 sql을 한땀한땀 작성하여 개발을 했으나 이는 개발 생산성이 뒤떨어진다. JPA를 사용하면 ...</p></div></div></a></div><div class="card"> <a href="/posts/2SQL-%EC%A4%91%EC%8B%AC%EC%A0%81%EC%9D%B8-%EA%B0%9C%EB%B0%9C%EC%9D%98-%EB%AC%B8%EC%A0%9C%EC%A0%90/"><div class="card-body"> <span class="timeago small" > Oct 22, 2021 <i class="unloaded">2021-10-22T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[자바 ORM 표준 JPA 프로그래밍-기본편] SQL 중심적인 개발의 문제점</h3><div class="text-muted small"><p> 본 포스팅은 인프러의 JPA 기본편을 수강하고 정리하는 내용입니다. 대부분의 기업들은 객체 지향 언어(java, scala)를 사용한다. 또한 DB로는 관계형 DB를 많이 사용하고 있다. 그래서 지금 시대는 객체를 관계형 DB에 관리하는 시대이다. 문제는 애플리케이션은 객체 지향 개발하면서 하는데 딱 코드를 까보면 SQL만 천지이다. 결국엔 ...</p></div></div></a></div><div class="card"> <a href="/posts/3JPA-%EC%86%8C%EA%B0%9C/"><div class="card-body"> <span class="timeago small" > Oct 25, 2021 <i class="unloaded">2021-10-25T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[자바 ORM 표준 JPA 프로그래밍-기본편] JPA 소개</h3><div class="text-muted small"><p> 본 포스팅은 인프러의 JPA 기본편을 수강하고 정리하는 내용입니다. JPA란? Java Persistence API의 준말 자바 진영의 ORM 기술 표준 ORM이란? Object-relational mapping(객체 관계 매핑) 객체는 객체대로 설계 관계형 데이터베이스는 관계형 데이터베이스대로 설...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/3JPA-%EC%86%8C%EA%B0%9C/" class="btn btn-outline-primary" prompt="Older"><p>[자바 ORM 표준 JPA 프로그래밍-기본편] JPA 소개</p></a> <a href="/posts/5%ED%94%8C%EB%9F%AC%EC%8B%9C/" class="btn btn-outline-primary" prompt="Newer"><p>[자바 ORM 표준 JPA 프로그래밍-기본편] 플러시</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/jeonyoungho_o">jeonyoungho</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/effectivejava/">effectivejava</a> <a class="post-tag" href="/tags/react/">react</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/es6/">es6</a> <a class="post-tag" href="/tags/velopert/">velopert</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/poiemaweb/">poiemaweb</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://jeonyoungho.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
